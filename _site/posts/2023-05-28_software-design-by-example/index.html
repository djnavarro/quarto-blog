<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.340">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Danielle Navarro">
<meta name="dcterms.date" content="2023-05-28">
<meta name="description" content="A book review, sort of. Not really.">

<title>Notes from a data witch - Software design by example</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<style>

      .quarto-title-block .quarto-title-banner {
        background: #eeeeee;
      }
</style>


<link rel="stylesheet" href="../../styles.css">
<meta property="og:title" content="Notes from a data witch - Software design by example">
<meta property="og:description" content="A book review, sort of. Not really.">
<meta property="og:image" content="https://blog.djnavarro.net/posts/2023-05-28_software-design-by-example/cover.jpg">
<meta property="og:site-name" content="Notes from a data witch">
<meta name="twitter:title" content="Notes from a data witch - Software design by example">
<meta name="twitter:description" content="A book review, sort of. Not really.">
<meta name="twitter:image" content="https://blog.djnavarro.net/posts/2023-05-28_software-design-by-example/cover.jpg">
<meta name="twitter:creator" content="@djnavarro">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html" rel="" target="">
 <span class="menu-text">Home</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-danielle-navarro" role="button" data-bs-toggle="dropdown" aria-expanded="false" rel="" target="">
 <span class="menu-text">Danielle Navarro</span>
    </a>
    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="nav-menu-danielle-navarro">    
        <li>
    <a class="dropdown-item" href="https://djnavarro.net" rel="" target="">
 <span class="dropdown-text">Homepage</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://blog.djnavarro.net" rel="" target="">
 <span class="dropdown-text">Data science blog</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://art.djnavarro.net" rel="" target="">
 <span class="dropdown-text">Generative art</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="https://papers.djnavarro.net" rel="" target="">
 <span class="dropdown-text">Academic papers</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default toc-left page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Software design by example</h1>
                  <div>
        <div class="description">
          A book review, sort of. Not really.
        </div>
      </div>
                </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p><a href="https://djnavarro.net">Danielle Navarro</a> <a href="https://orcid.org/0000-0001-7648-6578" class="quarto-title-author-orcid"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMC1jMDYwIDYxLjEzNDc3NywgMjAxMC8wMi8xMi0xNzozMjowMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDo1N0NEMjA4MDI1MjA2ODExOTk0QzkzNTEzRjZEQTg1NyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDozM0NDOEJGNEZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDozM0NDOEJGM0ZGNTcxMUUxODdBOEVCODg2RjdCQ0QwOSIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M1IE1hY2ludG9zaCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkZDN0YxMTc0MDcyMDY4MTE5NUZFRDc5MUM2MUUwNEREIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU3Q0QyMDgwMjUyMDY4MTE5OTRDOTM1MTNGNkRBODU3Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+84NovQAAAR1JREFUeNpiZEADy85ZJgCpeCB2QJM6AMQLo4yOL0AWZETSqACk1gOxAQN+cAGIA4EGPQBxmJA0nwdpjjQ8xqArmczw5tMHXAaALDgP1QMxAGqzAAPxQACqh4ER6uf5MBlkm0X4EGayMfMw/Pr7Bd2gRBZogMFBrv01hisv5jLsv9nLAPIOMnjy8RDDyYctyAbFM2EJbRQw+aAWw/LzVgx7b+cwCHKqMhjJFCBLOzAR6+lXX84xnHjYyqAo5IUizkRCwIENQQckGSDGY4TVgAPEaraQr2a4/24bSuoExcJCfAEJihXkWDj3ZAKy9EJGaEo8T0QSxkjSwORsCAuDQCD+QILmD1A9kECEZgxDaEZhICIzGcIyEyOl2RkgwAAhkmC+eAm0TAAAAABJRU5ErkJggg=="></a></p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 28, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#writing-a-tokenizer" id="toc-writing-a-tokenizer" class="nav-link active" data-scroll-target="#writing-a-tokenizer">Writing a tokenizer</a>
  <ul class="collapse">
  <li><a href="#preliminaries" id="toc-preliminaries" class="nav-link" data-scroll-target="#preliminaries">Preliminaries</a></li>
  <li><a href="#version-1" id="toc-version-1" class="nav-link" data-scroll-target="#version-1">Version 1</a></li>
  <li><a href="#version-2" id="toc-version-2" class="nav-link" data-scroll-target="#version-2">Version 2</a></li>
  <li><a href="#post-mortem" id="toc-post-mortem" class="nav-link" data-scroll-target="#post-mortem">Post-mortem</a></li>
  </ul></li>
  <li><a href="#parsing-the-tokens" id="toc-parsing-the-tokens" class="nav-link" data-scroll-target="#parsing-the-tokens">Parsing the tokens</a>
  <ul class="collapse">
  <li><a href="#version-1-1" id="toc-version-1-1" class="nav-link" data-scroll-target="#version-1-1">Version 1</a></li>
  <li><a href="#version-2-1" id="toc-version-2-1" class="nav-link" data-scroll-target="#version-2-1">Version 2</a></li>
  </ul></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<!--------------- my typical setup ----------------->
<!--------------- post begins here ----------------->
<p>The book I’m currently reading is <a href="https://www.routledge.com/Software-Design-by-Example-A-Tool-Based-Introduction-with-JavaScript/Wilson/p/book/9781032330235">Software Design by Example: A Tool-Based Introduction with JavaScript</a> by <a href="https://third-bit.com/">Greg Wilson</a>. Greg was kind enough to send me a review copy a little while back, and I’ve been slowly working my way through it.</p>
<p>In some ways I’m not the target audience for the book: it’s a book about software engineering that uses javascript for the worked examples, not a book designed to teach you javascript. I’m not the worst javascript coder in the world, but I’m not the strongest either, so it’s harder work for me than maybe it would have been if javascript were my primary language. That said, I’m finding the book rewarding. The glossary at the end is particularly helpful. I never received a formal education in programming, and I commonly have the experience in conversation that software engineers use terms that – though they are rarely complicated ideas – no-one has ever explained to me.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="cover.jpg" class="img-fluid figure-img"></p>
</figure>
</div>
<p>As an example, here’s a section from the glossary on the top of page 318:</p>
<blockquote class="blockquote">
<ul>
<li><strong>query string</strong>. The portion of a <strong>URL</strong> after the question mark ? that specfies extra parameters for the <strong>HTTP request</strong> as name-value pairs</li>
<li><strong>race condition</strong>. A situation in which a result depend on the order in which two or more concurrent operations are carried out.</li>
<li><strong>raise (an exception)</strong>. To signal that something unexpected or unusual has happened in a program by creating an <strong>exception</strong> and handling it to the <strong>error-handling</strong> system, which then tries to find a point in the program that will <strong>catch</strong> it.</li>
<li><strong>read-eval-print-loop (REPL)</strong>. An interactive program that reads a command typed in by a user, executes it, prints the result, and then waits patiently for the next command. REPLs are often used to explore new ideas, or for debugging.</li>
</ul>
</blockquote>
<p>I can honestly say that at no point in my life has someone explained to me what a “race condition” is or what a REPL does. When I read entries like this in the glossary I find myself going “oh, right, I did already know this… but now I know what the name for it is”. Race conditions are not unfamiliar to me (I encounter them quite a bit) but because software engineers have a tendency to talk to “race conditions” without ever saying what the term means, I’ve sat in a lot of very confusing conversations in the past that would have made perfect sense had I known the nomenclature.</p>
<p>I think that’s likely to be true for a lot of self-taught programmers who never studied computer science, but instead had to learn to code in order to solve practical problems. The mere act of reading a concise definition of each thing has the effect of making my mental model more precise. It’s a helpful way to learn the culture and avoid getting caught out by the various <a href="https://en.wikipedia.org/wiki/Shibboleth">shibboleths</a> that pervade the tech industry.</p>
<p>There are other examples of this sort of thing throughout the book, historical anecdotes and other tidbits that make it a little easier for an outsider to make sense of the culture of software engineering. As an example, this little passage on p145 makes sense of something I’ve never understood:</p>
<blockquote class="blockquote">
<p>The coordinate systems for screens puts (0, 0) in the upper left corner instead of the lower left. X increases to the right as usual, but Y increases as we go down, rather than up [The book has a little picture here]. This convention is a holdover from the days of teletype terminals that printed lines on rolls of paper</p>
</blockquote>
<p>These historical asides are really valuable. It feels a little bit like one of those “Magician’s Secrets Revealed!” shows. Knowing the terminology, conventions, and history behind a thing does so much of the work in making it all feel a bit more coherent.</p>
<section id="writing-a-tokenizer" class="level2">
<h2 class="anchored" data-anchor-id="writing-a-tokenizer">Writing a tokenizer</h2>
<section id="preliminaries" class="level3">
<h3 class="anchored" data-anchor-id="preliminaries">Preliminaries</h3>
<div class="cell" data-file="token_class.R">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>token_class.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a>token <span class="ot">&lt;-</span> <span class="cf">function</span>(kind, loc, <span class="at">value =</span> <span class="cn">NULL</span>) {</span>
<span id="cb1-2"><a href="#cb1-2"></a>  <span class="fu">structure</span>(</span>
<span id="cb1-3"><a href="#cb1-3"></a>    <span class="fu">list</span>(<span class="at">kind =</span> kind, <span class="at">loc =</span> loc, <span class="at">value =</span> value),</span>
<span id="cb1-4"><a href="#cb1-4"></a>    <span class="at">class =</span> <span class="st">"token"</span></span>
<span id="cb1-5"><a href="#cb1-5"></a>  )</span>
<span id="cb1-6"><a href="#cb1-6"></a>}</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a>token_list <span class="ot">&lt;-</span> <span class="cf">function</span>(...) {</span>
<span id="cb1-9"><a href="#cb1-9"></a>  <span class="fu">structure</span>(</span>
<span id="cb1-10"><a href="#cb1-10"></a>    <span class="fu">list</span>(...),</span>
<span id="cb1-11"><a href="#cb1-11"></a>    <span class="at">class =</span> <span class="st">"token_list"</span></span>
<span id="cb1-12"><a href="#cb1-12"></a>  )</span>
<span id="cb1-13"><a href="#cb1-13"></a>}</span>
<span id="cb1-14"><a href="#cb1-14"></a></span>
<span id="cb1-15"><a href="#cb1-15"></a>print.token <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) {</span>
<span id="cb1-16"><a href="#cb1-16"></a>  <span class="fu">cat</span>(<span class="st">"&lt;Token at "</span>,  x<span class="sc">$</span>loc, <span class="st">"&gt; "</span>, x<span class="sc">$</span>kind, <span class="at">sep =</span> <span class="st">""</span>)</span>
<span id="cb1-17"><a href="#cb1-17"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(x<span class="sc">$</span>value)) {</span>
<span id="cb1-18"><a href="#cb1-18"></a>    <span class="fu">cat</span>(<span class="st">":"</span>, x<span class="sc">$</span>value)</span>
<span id="cb1-19"><a href="#cb1-19"></a>  }</span>
<span id="cb1-20"><a href="#cb1-20"></a>  <span class="fu">cat</span>(<span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb1-21"><a href="#cb1-21"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(x))</span>
<span id="cb1-22"><a href="#cb1-22"></a>}</span>
<span id="cb1-23"><a href="#cb1-23"></a></span>
<span id="cb1-24"><a href="#cb1-24"></a>print.token_list <span class="ot">&lt;-</span> <span class="cf">function</span>(x, ...) {</span>
<span id="cb1-25"><a href="#cb1-25"></a>  <span class="cf">if</span>(<span class="fu">length</span>(x) <span class="sc">==</span> <span class="dv">0</span>) {</span>
<span id="cb1-26"><a href="#cb1-26"></a>    <span class="fu">cat</span>(<span class="st">"&lt;Empty token list&gt;</span><span class="sc">\n</span><span class="st">"</span>)</span>
<span id="cb1-27"><a href="#cb1-27"></a>  } <span class="cf">else</span> {</span>
<span id="cb1-28"><a href="#cb1-28"></a>    <span class="cf">for</span>(token <span class="cf">in</span> x) {</span>
<span id="cb1-29"><a href="#cb1-29"></a>      <span class="fu">print</span>(token)</span>
<span id="cb1-30"><a href="#cb1-30"></a>    }</span>
<span id="cb1-31"><a href="#cb1-31"></a>  }</span>
<span id="cb1-32"><a href="#cb1-32"></a>  <span class="fu">return</span>(<span class="fu">invisible</span>(x))</span>
<span id="cb1-33"><a href="#cb1-33"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="version-1" class="level3">
<h3 class="anchored" data-anchor-id="version-1">Version 1</h3>
<div class="cell" data-file="tokenizer_1.R">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>tokenizer_1.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>simple <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb2-2"><a href="#cb2-2"></a>  <span class="st">"*"</span> <span class="ot">=</span> <span class="st">"Any"</span>,</span>
<span id="cb2-3"><a href="#cb2-3"></a>  <span class="st">"|"</span> <span class="ot">=</span> <span class="st">"Or"</span>,</span>
<span id="cb2-4"><a href="#cb2-4"></a>  <span class="st">"("</span> <span class="ot">=</span> <span class="st">"GroupStart"</span>,</span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="st">")"</span> <span class="ot">=</span> <span class="st">"GroupEnd"</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>)</span>
<span id="cb2-7"><a href="#cb2-7"></a></span>
<span id="cb2-8"><a href="#cb2-8"></a>tokenize <span class="ot">&lt;-</span> <span class="cf">function</span>(text) {</span>
<span id="cb2-9"><a href="#cb2-9"></a>  result <span class="ot">&lt;-</span> <span class="fu">token_list</span>()</span>
<span id="cb2-10"><a href="#cb2-10"></a>  n <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb2-11"><a href="#cb2-11"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nchar</span>(text)) {</span>
<span id="cb2-12"><a href="#cb2-12"></a>    chr <span class="ot">&lt;-</span> <span class="fu">substr</span>(text, <span class="at">start =</span> i, <span class="at">stop =</span> i)</span>
<span id="cb2-13"><a href="#cb2-13"></a></span>
<span id="cb2-14"><a href="#cb2-14"></a>    <span class="co"># simple cases are always added as non-literal tokens</span></span>
<span id="cb2-15"><a href="#cb2-15"></a>    <span class="cf">if</span> (chr <span class="sc">%in%</span> <span class="fu">names</span>(simple)) {</span>
<span id="cb2-16"><a href="#cb2-16"></a>      result[[n <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">token</span>(simple[[chr]], i)</span>
<span id="cb2-17"><a href="#cb2-17"></a>      n <span class="ot">&lt;-</span> n <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2-18"><a href="#cb2-18"></a></span>
<span id="cb2-19"><a href="#cb2-19"></a>    <span class="co"># the ^ character is non-literal if position is 1</span></span>
<span id="cb2-20"><a href="#cb2-20"></a>    } <span class="cf">else</span> <span class="cf">if</span> (chr <span class="sc">==</span> <span class="st">"^"</span> <span class="sc">&amp;</span> i <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb2-21"><a href="#cb2-21"></a>      result[[n <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">token</span>(<span class="st">"Start"</span>, i)</span>
<span id="cb2-22"><a href="#cb2-22"></a>      n <span class="ot">&lt;-</span> n <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2-23"><a href="#cb2-23"></a></span>
<span id="cb2-24"><a href="#cb2-24"></a>    <span class="co"># the $ character is non-literal if it's the last character</span></span>
<span id="cb2-25"><a href="#cb2-25"></a>    } <span class="cf">else</span> <span class="cf">if</span> (chr <span class="sc">==</span> <span class="st">"$"</span> <span class="sc">&amp;</span> i <span class="sc">==</span> <span class="fu">nchar</span>(text)) {</span>
<span id="cb2-26"><a href="#cb2-26"></a>      result[[n <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">token</span>(<span class="st">"End"</span>, i)</span>
<span id="cb2-27"><a href="#cb2-27"></a>      n <span class="ot">&lt;-</span> n <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2-28"><a href="#cb2-28"></a></span>
<span id="cb2-29"><a href="#cb2-29"></a>    <span class="co"># literals that follow a non-literal create a new token</span></span>
<span id="cb2-30"><a href="#cb2-30"></a>    } <span class="cf">else</span> <span class="cf">if</span> (n <span class="sc">&gt;</span> <span class="dv">0</span> <span class="sc">&amp;&amp;</span> result[[n]]<span class="sc">$</span>kind <span class="sc">!=</span> <span class="st">"Literal"</span>){</span>
<span id="cb2-31"><a href="#cb2-31"></a>      result[[n <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">token</span>(<span class="st">"Literal"</span>, i, <span class="at">value =</span> chr)</span>
<span id="cb2-32"><a href="#cb2-32"></a>      n <span class="ot">&lt;-</span> n <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb2-33"><a href="#cb2-33"></a></span>
<span id="cb2-34"><a href="#cb2-34"></a>    <span class="co"># literals that follow a literal are combined with it</span></span>
<span id="cb2-35"><a href="#cb2-35"></a>    } <span class="cf">else</span> {</span>
<span id="cb2-36"><a href="#cb2-36"></a>      result[[n]]<span class="sc">$</span>value <span class="ot">&lt;-</span> <span class="fu">paste0</span>(result[[n]]<span class="sc">$</span>value, chr)</span>
<span id="cb2-37"><a href="#cb2-37"></a>    }</span>
<span id="cb2-38"><a href="#cb2-38"></a>  }</span>
<span id="cb2-39"><a href="#cb2-39"></a>  <span class="fu">return</span>(result)</span>
<span id="cb2-40"><a href="#cb2-40"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"token_class.R"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"tokenizer_1.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tokenize</span>(<span class="st">"^(cat|dog)$"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Token at 1&gt; Start
&lt;Token at 2&gt; GroupStart
&lt;Token at 3&gt; Literal: cat
&lt;Token at 6&gt; Or
&lt;Token at 7&gt; Literal: dog
&lt;Token at 10&gt; GroupEnd
&lt;Token at 11&gt; End</code></pre>
</div>
</div>
<p>Merging a sequence of literal characters into a single multi-character literal makes the output readable, and in this case is very convenient if I later wanted to write a regular expression matcher that builds on top of this tokenizer:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grepl</span>(<span class="st">"^(cat|dog)$"</span>, <span class="fu">c</span>(<span class="st">"cat"</span>, <span class="st">"dog"</span>, <span class="st">"dag"</span>, <span class="st">"ca"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE  TRUE FALSE FALSE</code></pre>
</div>
</div>
<p>If my tokenizer represent the literals in <code>^(cat|dog)$</code> as the two multicharacter literals <code>"cat"</code> and <code>"dog"</code> then it’s going to be easier for me to write a regex matcher that mirrors the behaviour of <code>grepl()</code>.</p>
<p>Unfortunately, there’s a problem with this tokenizer. It’s trying to be clever, by grouping multiple literals together, and it ends up being too greedy sometimes. Consider the regular expression <code>"^caa*t$"</code>. This is a pattern that should match against <code>"cat"</code> and <code>"caaaaat"</code> but should not match <code>"caacaat"</code>, as illustrated below:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">grepl</span>(<span class="st">"^caa*t$"</span>, <span class="fu">c</span>(<span class="st">"cat"</span>, <span class="st">"caaaaat"</span>, <span class="st">"caacaat"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1]  TRUE  TRUE FALSE</code></pre>
</div>
</div>
<p>However, let’s look at the tokens that are produced by this version of our <code>tokenizer()</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tokenize</span>(<span class="st">"^caa*t$"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Token at 1&gt; Start
&lt;Token at 2&gt; Literal: caa
&lt;Token at 5&gt; Any
&lt;Token at 6&gt; Literal: t
&lt;Token at 7&gt; End</code></pre>
</div>
</div>
<p>That’s the wrong way to tokenize this input: in this regular expression the <code>*</code> operator should be applied only to the preceding character, so it’s not correct to treat <code>"caa"</code> as a single literal string. What we should have done is split this into literals, <code>"ca"</code> and <code>"a"</code>. The <code>"ca"</code> literal is required and must appear at the beginning of the string (because it follows the start operator <code>^</code>), whereas <code>"a"</code> is optional and may appear zero or more times (because it precedes the any operator <code>*</code>). A tokenizer that collapses these into a single literal <code>"caa"</code> will make life hell for any regular expression parser that tries to work with these tokens.</p>
<p>In essence, this tokenizer fails because it’s trying to be a parser as well as a tokenizer, and as a consequence it solves both problems badly.</p>
</section>
<section id="version-2" class="level3">
<h3 class="anchored" data-anchor-id="version-2">Version 2</h3>
<p>Okay so that doesn’t work. The second approach considered in the chapter simplifies the code a little and produces a token list where every literal character is treated as a distinct token:</p>
<div class="cell" data-file="tokenizer_2.R">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>tokenizer_2.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>simple <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb12-2"><a href="#cb12-2"></a>  <span class="st">"*"</span> <span class="ot">=</span> <span class="st">"Any"</span>,</span>
<span id="cb12-3"><a href="#cb12-3"></a>  <span class="st">"|"</span> <span class="ot">=</span> <span class="st">"Or"</span>,</span>
<span id="cb12-4"><a href="#cb12-4"></a>  <span class="st">"("</span> <span class="ot">=</span> <span class="st">"GroupStart"</span>,</span>
<span id="cb12-5"><a href="#cb12-5"></a>  <span class="st">")"</span> <span class="ot">=</span> <span class="st">"GroupEnd"</span></span>
<span id="cb12-6"><a href="#cb12-6"></a>)</span>
<span id="cb12-7"><a href="#cb12-7"></a></span>
<span id="cb12-8"><a href="#cb12-8"></a>tokenize <span class="ot">&lt;-</span> <span class="cf">function</span>(text) {</span>
<span id="cb12-9"><a href="#cb12-9"></a>  result <span class="ot">&lt;-</span> <span class="fu">token_list</span>()</span>
<span id="cb12-10"><a href="#cb12-10"></a>  n <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb12-11"><a href="#cb12-11"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nchar</span>(text)) {</span>
<span id="cb12-12"><a href="#cb12-12"></a>    chr <span class="ot">&lt;-</span> <span class="fu">substr</span>(text, <span class="at">start =</span> i, <span class="at">stop =</span> i)</span>
<span id="cb12-13"><a href="#cb12-13"></a></span>
<span id="cb12-14"><a href="#cb12-14"></a>    <span class="co"># simple cases are always added as non-literal tokens</span></span>
<span id="cb12-15"><a href="#cb12-15"></a>    <span class="cf">if</span> (chr <span class="sc">%in%</span> <span class="fu">names</span>(simple)) {</span>
<span id="cb12-16"><a href="#cb12-16"></a>      result[[n <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">token</span>(simple[[chr]], i)</span>
<span id="cb12-17"><a href="#cb12-17"></a>      n <span class="ot">&lt;-</span> n <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb12-18"><a href="#cb12-18"></a></span>
<span id="cb12-19"><a href="#cb12-19"></a>    <span class="co"># the ^ character is non-literal if position is 1</span></span>
<span id="cb12-20"><a href="#cb12-20"></a>    } <span class="cf">else</span> <span class="cf">if</span> (chr <span class="sc">==</span> <span class="st">"^"</span> <span class="sc">&amp;</span> i <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb12-21"><a href="#cb12-21"></a>      result[[n <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">token</span>(<span class="st">"Start"</span>, i)</span>
<span id="cb12-22"><a href="#cb12-22"></a>      n <span class="ot">&lt;-</span> n <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb12-23"><a href="#cb12-23"></a></span>
<span id="cb12-24"><a href="#cb12-24"></a>    <span class="co"># the $ character is non-literal if it's the last character</span></span>
<span id="cb12-25"><a href="#cb12-25"></a>    } <span class="cf">else</span> <span class="cf">if</span> (chr <span class="sc">==</span> <span class="st">"$"</span> <span class="sc">&amp;</span> i <span class="sc">==</span> <span class="fu">nchar</span>(text)) {</span>
<span id="cb12-26"><a href="#cb12-26"></a>      result[[n <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">token</span>(<span class="st">"End"</span>, i)</span>
<span id="cb12-27"><a href="#cb12-27"></a>      n <span class="ot">&lt;-</span> n <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb12-28"><a href="#cb12-28"></a></span>
<span id="cb12-29"><a href="#cb12-29"></a>    <span class="co"># literals always create a new token</span></span>
<span id="cb12-30"><a href="#cb12-30"></a>    } <span class="cf">else</span> {</span>
<span id="cb12-31"><a href="#cb12-31"></a>      result[[n <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">token</span>(<span class="st">"Literal"</span>, i, <span class="at">value =</span> chr)</span>
<span id="cb12-32"><a href="#cb12-32"></a>      n <span class="ot">&lt;-</span> n <span class="sc">+</span> <span class="dv">1</span></span>
<span id="cb12-33"><a href="#cb12-33"></a>    }</span>
<span id="cb12-34"><a href="#cb12-34"></a>  }</span>
<span id="cb12-35"><a href="#cb12-35"></a>  <span class="fu">return</span>(result)</span>
<span id="cb12-36"><a href="#cb12-36"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"token_class.R"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"tokenizer_2.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Here’s the sort of output we get from this version of the tokenizer:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tokenize</span>(<span class="st">"^caa*t$"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Token at 1&gt; Start
&lt;Token at 2&gt; Literal: c
&lt;Token at 3&gt; Literal: a
&lt;Token at 4&gt; Literal: a
&lt;Token at 5&gt; Any
&lt;Token at 6&gt; Literal: t
&lt;Token at 7&gt; End</code></pre>
</div>
</div>
<p>This output is entirely correct, as long as our goal is <em>only</em> to extract and label the tokens in our regular expression. The output correctly labels each literal as a literal and assigns the appropriate label to the non-literals. The problem, however, is that doesn’t solve the parsing problem. We’ve lost the grouping structure that we had in our original version. The tokenizer has no way of expressing the idea that <code>"ca"</code> is a syntactically coherent unit in the expression <code>^caa*t$</code>, or that <code>"cat"</code> is similarly coherent within <code>^(cat|dog)$</code>. It’s a tokenizer, but not a parser.</p>
<p>Fortunately, we can build a parser on top of this tokenizer. It requires a little thought, but it’s achieveable because the tokenizer is reliable <em>as</em> a tokenizer.</p>
</section>
<section id="post-mortem" class="level3">
<h3 class="anchored" data-anchor-id="post-mortem">Post-mortem</h3>
<p>At this point any competent software engineer is probably screaming internally, because I have not written any unit tests for my code. This is terribly bad practice, and something I would never do when writing actual software. Suffice it to say <em>Software Design by Example</em> is at great pains to emphasize the importance of unit tests, and if you were actually following the chapter step by step you’d see that Greg does in fact introduce tests as he develops this example. I’ve been lazy in this blog post because… well, it’s a blog post. It’s neither intended to be software nor a chapter in a book on software engineering.</p>
<p>Anyway… let’s return to the development of ideas in the chapter, yes?</p>
</section>
</section>
<section id="parsing-the-tokens" class="level2">
<h2 class="anchored" data-anchor-id="parsing-the-tokens">Parsing the tokens</h2>
<section id="version-1-1" class="level3">
<h3 class="anchored" data-anchor-id="version-1-1">Version 1</h3>
<div class="cell" data-file="parser_1.R">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>parser_1.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1"></a>list_reverse <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb16-2"><a href="#cb16-2"></a>  x[<span class="fu">length</span>(x)<span class="sc">:</span><span class="dv">1</span>]</span>
<span id="cb16-3"><a href="#cb16-3"></a>}</span>
<span id="cb16-4"><a href="#cb16-4"></a></span>
<span id="cb16-5"><a href="#cb16-5"></a>update_tree <span class="ot">&lt;-</span> <span class="cf">function</span>(tree, token) {</span>
<span id="cb16-6"><a href="#cb16-6"></a></span>
<span id="cb16-7"><a href="#cb16-7"></a>  <span class="co"># For some kinds of token, we simply append them to the tree</span></span>
<span id="cb16-8"><a href="#cb16-8"></a>  <span class="cf">if</span>(token<span class="sc">$</span>kind <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Literal"</span>, <span class="st">"Start"</span>, <span class="st">"End"</span>, <span class="st">"GroupStart"</span>)) {</span>
<span id="cb16-9"><a href="#cb16-9"></a>    tree[[<span class="fu">length</span>(tree) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">subtree</span>(token)</span>
<span id="cb16-10"><a href="#cb16-10"></a>  }</span>
<span id="cb16-11"><a href="#cb16-11"></a></span>
<span id="cb16-12"><a href="#cb16-12"></a>  <span class="co"># When GroupEnd is encountered, find the most recent GroupStart and</span></span>
<span id="cb16-13"><a href="#cb16-13"></a>  <span class="co"># make the tokens between them the children of a Group</span></span>
<span id="cb16-14"><a href="#cb16-14"></a>  <span class="cf">if</span> (token<span class="sc">$</span>kind <span class="sc">==</span> <span class="st">"GroupEnd"</span>) {</span>
<span id="cb16-15"><a href="#cb16-15"></a>    children <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb16-16"><a href="#cb16-16"></a>    <span class="cf">while</span>(<span class="cn">TRUE</span>) {</span>
<span id="cb16-17"><a href="#cb16-17"></a>      last <span class="ot">&lt;-</span> tree[[<span class="fu">length</span>(tree)]]</span>
<span id="cb16-18"><a href="#cb16-18"></a>      tree <span class="ot">&lt;-</span> tree[<span class="sc">-</span><span class="fu">length</span>(tree)]</span>
<span id="cb16-19"><a href="#cb16-19"></a>      <span class="cf">if</span>(last<span class="sc">$</span>parent<span class="sc">$</span>kind <span class="sc">==</span> <span class="st">"GroupStart"</span>) {</span>
<span id="cb16-20"><a href="#cb16-20"></a>        <span class="cf">break</span></span>
<span id="cb16-21"><a href="#cb16-21"></a>      }</span>
<span id="cb16-22"><a href="#cb16-22"></a>      children[[<span class="fu">length</span>(children) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> last</span>
<span id="cb16-23"><a href="#cb16-23"></a>    }</span>
<span id="cb16-24"><a href="#cb16-24"></a>    tree[[<span class="fu">length</span>(tree) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">subtree</span>(</span>
<span id="cb16-25"><a href="#cb16-25"></a>      <span class="at">parent =</span> <span class="fu">token</span>(<span class="st">"Group"</span>, last<span class="sc">$</span>parent<span class="sc">$</span>loc),</span>
<span id="cb16-26"><a href="#cb16-26"></a>      <span class="at">children =</span> <span class="fu">list_reverse</span>(children)</span>
<span id="cb16-27"><a href="#cb16-27"></a>    )</span>
<span id="cb16-28"><a href="#cb16-28"></a>  }</span>
<span id="cb16-29"><a href="#cb16-29"></a></span>
<span id="cb16-30"><a href="#cb16-30"></a>  <span class="co"># When Any is encountered, make the preceding token (or subtree)</span></span>
<span id="cb16-31"><a href="#cb16-31"></a>  <span class="co"># the child of the Any token</span></span>
<span id="cb16-32"><a href="#cb16-32"></a>  <span class="cf">if</span> (token<span class="sc">$</span>kind <span class="sc">==</span> <span class="st">"Any"</span>) {</span>
<span id="cb16-33"><a href="#cb16-33"></a>    last <span class="ot">&lt;-</span> tree[[<span class="fu">length</span>(tree)]]</span>
<span id="cb16-34"><a href="#cb16-34"></a>    tree[[<span class="fu">length</span>(tree)]] <span class="ot">&lt;-</span> <span class="fu">subtree</span>(</span>
<span id="cb16-35"><a href="#cb16-35"></a>      <span class="at">parent =</span> token,</span>
<span id="cb16-36"><a href="#cb16-36"></a>      <span class="at">children =</span> <span class="fu">list</span>(last)</span>
<span id="cb16-37"><a href="#cb16-37"></a>    )</span>
<span id="cb16-38"><a href="#cb16-38"></a>  }</span>
<span id="cb16-39"><a href="#cb16-39"></a></span>
<span id="cb16-40"><a href="#cb16-40"></a>  <span class="co"># When Or is encountered, create a subtree with two children. The</span></span>
<span id="cb16-41"><a href="#cb16-41"></a>  <span class="co"># first (or left) child is taken by moving it from the previous</span></span>
<span id="cb16-42"><a href="#cb16-42"></a>  <span class="co"># token/subtree in our list. The second child is tagged as "Missing"</span></span>
<span id="cb16-43"><a href="#cb16-43"></a>  <span class="co"># and will be filled in later</span></span>
<span id="cb16-44"><a href="#cb16-44"></a>  <span class="cf">if</span> (token<span class="sc">$</span>kind <span class="sc">==</span> <span class="st">"Or"</span>) {</span>
<span id="cb16-45"><a href="#cb16-45"></a>    last <span class="ot">&lt;-</span> tree[[<span class="fu">length</span>(tree)]]</span>
<span id="cb16-46"><a href="#cb16-46"></a>    tree[[<span class="fu">length</span>(tree)]] <span class="ot">&lt;-</span> <span class="fu">subtree</span>(</span>
<span id="cb16-47"><a href="#cb16-47"></a>      <span class="at">parent =</span> token,</span>
<span id="cb16-48"><a href="#cb16-48"></a>      <span class="at">children =</span> <span class="fu">list</span>(last, <span class="fu">subtree</span>(<span class="fu">token</span>(<span class="at">kind =</span> <span class="st">"Missing"</span>, <span class="at">loc =</span> <span class="dv">0</span>)))</span>
<span id="cb16-49"><a href="#cb16-49"></a>    )</span>
<span id="cb16-50"><a href="#cb16-50"></a>  }</span>
<span id="cb16-51"><a href="#cb16-51"></a></span>
<span id="cb16-52"><a href="#cb16-52"></a>  <span class="fu">return</span>(tree)</span>
<span id="cb16-53"><a href="#cb16-53"></a>}</span>
<span id="cb16-54"><a href="#cb16-54"></a></span>
<span id="cb16-55"><a href="#cb16-55"></a>parse <span class="ot">&lt;-</span> <span class="cf">function</span>(text) {</span>
<span id="cb16-56"><a href="#cb16-56"></a>  tree <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb16-57"><a href="#cb16-57"></a>  tokens <span class="ot">&lt;-</span> <span class="fu">tokenize</span>(text)</span>
<span id="cb16-58"><a href="#cb16-58"></a>  <span class="cf">for</span>(token <span class="cf">in</span> tokens) {</span>
<span id="cb16-59"><a href="#cb16-59"></a>    tree <span class="ot">&lt;-</span> <span class="fu">update_tree</span>(tree, token)</span>
<span id="cb16-60"><a href="#cb16-60"></a>  }</span>
<span id="cb16-61"><a href="#cb16-61"></a>  <span class="fu">class</span>(tree) <span class="ot">&lt;-</span> <span class="st">"token_list"</span> <span class="co"># allows pretty printing</span></span>
<span id="cb16-62"><a href="#cb16-62"></a>  <span class="fu">return</span>(tree)</span>
<span id="cb16-63"><a href="#cb16-63"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"token_class.R"</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"parse_class.R"</span>)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"tokenizer_2.R"</span>)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"parser_1.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parse</span>(<span class="st">"^caa*t$"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Token at 1&gt; Start
&lt;Token at 2&gt; Literal: c
&lt;Token at 3&gt; Literal: a
&lt;Token at 5&gt; Any
     &lt;Token at 4&gt; Literal: a
&lt;Token at 6&gt; Literal: t
&lt;Token at 7&gt; End</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parse</span>(<span class="st">"aa|b"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Token at 1&gt; Literal: a
&lt;Token at 3&gt; Or
     &lt;Token at 2&gt; Literal: a
     &lt;Token at 0&gt; Missing
&lt;Token at 4&gt; Literal: b</code></pre>
</div>
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parse</span>(<span class="st">"(ab)|c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Token at 5&gt; Or
     &lt;Token at 1&gt; Group
          &lt;Token at 2&gt; Literal: a
          &lt;Token at 3&gt; Literal: b
     &lt;Token at 0&gt; Missing
&lt;Token at 6&gt; Literal: c</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parse</span>(<span class="st">"^(caa*t)|(dog)$"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Token at 1&gt; Start
&lt;Token at 9&gt; Or
     &lt;Token at 2&gt; Group
          &lt;Token at 3&gt; Literal: c
          &lt;Token at 4&gt; Literal: a
          &lt;Token at 6&gt; Any
               &lt;Token at 5&gt; Literal: a
          &lt;Token at 7&gt; Literal: t
     &lt;Token at 0&gt; Missing
&lt;Token at 10&gt; Group
     &lt;Token at 11&gt; Literal: d
     &lt;Token at 12&gt; Literal: o
     &lt;Token at 13&gt; Literal: g
&lt;Token at 15&gt; End</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parse</span>(<span class="st">"ab|((cd*)|ef)|g"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Token at 1&gt; Literal: a
&lt;Token at 3&gt; Or
     &lt;Token at 2&gt; Literal: b
     &lt;Token at 0&gt; Missing
&lt;Token at 14&gt; Or
     &lt;Token at 4&gt; Group
          &lt;Token at 10&gt; Or
               &lt;Token at 5&gt; Group
                    &lt;Token at 6&gt; Literal: c
                    &lt;Token at 8&gt; Any
                         &lt;Token at 7&gt; Literal: d
               &lt;Token at 0&gt; Missing
          &lt;Token at 11&gt; Literal: e
          &lt;Token at 12&gt; Literal: f
     &lt;Token at 0&gt; Missing
&lt;Token at 15&gt; Literal: g</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parse</span>(<span class="st">"x|(y|z)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Token at 2&gt; Or
     &lt;Token at 1&gt; Literal: x
     &lt;Token at 0&gt; Missing
&lt;Token at 3&gt; Group
     &lt;Token at 5&gt; Or
          &lt;Token at 4&gt; Literal: y
          &lt;Token at 0&gt; Missing
     &lt;Token at 6&gt; Literal: z</code></pre>
</div>
</div>
</section>
<section id="version-2-1" class="level3">
<h3 class="anchored" data-anchor-id="version-2-1">Version 2</h3>
<div class="cell" data-file="parser_2.R">
<div class="code-with-filename">
<div class="code-with-filename-file">
<pre><strong>parser_2.R</strong></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a>list_reverse <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb30-2"><a href="#cb30-2"></a>  x[<span class="fu">length</span>(x)<span class="sc">:</span><span class="dv">1</span>]</span>
<span id="cb30-3"><a href="#cb30-3"></a>}</span>
<span id="cb30-4"><a href="#cb30-4"></a></span>
<span id="cb30-5"><a href="#cb30-5"></a>update_tree <span class="ot">&lt;-</span> <span class="cf">function</span>(tree, token) {</span>
<span id="cb30-6"><a href="#cb30-6"></a></span>
<span id="cb30-7"><a href="#cb30-7"></a>  <span class="co"># For some kinds of token, we simply append them to the tree</span></span>
<span id="cb30-8"><a href="#cb30-8"></a>  <span class="cf">if</span>(token<span class="sc">$</span>kind <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Literal"</span>, <span class="st">"Start"</span>, <span class="st">"End"</span>, <span class="st">"GroupStart"</span>)) {</span>
<span id="cb30-9"><a href="#cb30-9"></a>    tree[[<span class="fu">length</span>(tree) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">subtree</span>(token)</span>
<span id="cb30-10"><a href="#cb30-10"></a>  }</span>
<span id="cb30-11"><a href="#cb30-11"></a></span>
<span id="cb30-12"><a href="#cb30-12"></a>  <span class="co"># When GroupEnd is encountered, find the most recent GroupStart and</span></span>
<span id="cb30-13"><a href="#cb30-13"></a>  <span class="co"># make the tokens between them the children of a Group</span></span>
<span id="cb30-14"><a href="#cb30-14"></a>  <span class="cf">if</span> (token<span class="sc">$</span>kind <span class="sc">==</span> <span class="st">"GroupEnd"</span>) {</span>
<span id="cb30-15"><a href="#cb30-15"></a>    children <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb30-16"><a href="#cb30-16"></a>    <span class="cf">while</span>(<span class="cn">TRUE</span>) {</span>
<span id="cb30-17"><a href="#cb30-17"></a>      last <span class="ot">&lt;-</span> tree[[<span class="fu">length</span>(tree)]]</span>
<span id="cb30-18"><a href="#cb30-18"></a>      tree <span class="ot">&lt;-</span> tree[<span class="sc">-</span><span class="fu">length</span>(tree)]</span>
<span id="cb30-19"><a href="#cb30-19"></a>      <span class="cf">if</span>(last<span class="sc">$</span>parent<span class="sc">$</span>kind <span class="sc">==</span> <span class="st">"GroupStart"</span>) {</span>
<span id="cb30-20"><a href="#cb30-20"></a>        <span class="cf">break</span></span>
<span id="cb30-21"><a href="#cb30-21"></a>      }</span>
<span id="cb30-22"><a href="#cb30-22"></a>      children[[<span class="fu">length</span>(children) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> last</span>
<span id="cb30-23"><a href="#cb30-23"></a>    }</span>
<span id="cb30-24"><a href="#cb30-24"></a>    tree[[<span class="fu">length</span>(tree) <span class="sc">+</span> <span class="dv">1</span>]] <span class="ot">&lt;-</span> <span class="fu">subtree</span>(</span>
<span id="cb30-25"><a href="#cb30-25"></a>      <span class="at">parent =</span> <span class="fu">token</span>(<span class="st">"Group"</span>, last<span class="sc">$</span>parent<span class="sc">$</span>loc),</span>
<span id="cb30-26"><a href="#cb30-26"></a>      <span class="at">children =</span> <span class="fu">list_reverse</span>(children)</span>
<span id="cb30-27"><a href="#cb30-27"></a>    )</span>
<span id="cb30-28"><a href="#cb30-28"></a>  }</span>
<span id="cb30-29"><a href="#cb30-29"></a></span>
<span id="cb30-30"><a href="#cb30-30"></a>  <span class="co"># When Any is encountered, make the preceding token (or subtree)</span></span>
<span id="cb30-31"><a href="#cb30-31"></a>  <span class="co"># the child of the Any token</span></span>
<span id="cb30-32"><a href="#cb30-32"></a>  <span class="cf">if</span> (token<span class="sc">$</span>kind <span class="sc">==</span> <span class="st">"Any"</span>) {</span>
<span id="cb30-33"><a href="#cb30-33"></a>    last <span class="ot">&lt;-</span> tree[[<span class="fu">length</span>(tree)]]</span>
<span id="cb30-34"><a href="#cb30-34"></a>    tree[[<span class="fu">length</span>(tree)]] <span class="ot">&lt;-</span> <span class="fu">subtree</span>(</span>
<span id="cb30-35"><a href="#cb30-35"></a>      <span class="at">parent =</span> token,</span>
<span id="cb30-36"><a href="#cb30-36"></a>      <span class="at">children =</span> <span class="fu">list</span>(last)</span>
<span id="cb30-37"><a href="#cb30-37"></a>    )</span>
<span id="cb30-38"><a href="#cb30-38"></a>  }</span>
<span id="cb30-39"><a href="#cb30-39"></a></span>
<span id="cb30-40"><a href="#cb30-40"></a>  <span class="co"># When Or is encountered, create a subtree with two children. The</span></span>
<span id="cb30-41"><a href="#cb30-41"></a>  <span class="co"># first (or left) child is taken by moving it from the previous</span></span>
<span id="cb30-42"><a href="#cb30-42"></a>  <span class="co"># token/subtree in our list. The second child is tagged as "Missing"</span></span>
<span id="cb30-43"><a href="#cb30-43"></a>  <span class="co"># and will be filled in later</span></span>
<span id="cb30-44"><a href="#cb30-44"></a>  <span class="cf">if</span> (token<span class="sc">$</span>kind <span class="sc">==</span> <span class="st">"Or"</span>) {</span>
<span id="cb30-45"><a href="#cb30-45"></a>    last <span class="ot">&lt;-</span> tree[[<span class="fu">length</span>(tree)]]</span>
<span id="cb30-46"><a href="#cb30-46"></a>    tree[[<span class="fu">length</span>(tree)]] <span class="ot">&lt;-</span> <span class="fu">subtree</span>(</span>
<span id="cb30-47"><a href="#cb30-47"></a>      <span class="at">parent =</span> token,</span>
<span id="cb30-48"><a href="#cb30-48"></a>      <span class="at">children =</span> <span class="fu">list</span>(last, <span class="fu">subtree</span>(<span class="fu">token</span>(<span class="at">kind =</span> <span class="st">"Missing"</span>, <span class="at">loc =</span> <span class="dv">0</span>)))</span>
<span id="cb30-49"><a href="#cb30-49"></a>    )</span>
<span id="cb30-50"><a href="#cb30-50"></a>  }</span>
<span id="cb30-51"><a href="#cb30-51"></a></span>
<span id="cb30-52"><a href="#cb30-52"></a>  <span class="fu">return</span>(tree)</span>
<span id="cb30-53"><a href="#cb30-53"></a>}</span>
<span id="cb30-54"><a href="#cb30-54"></a></span>
<span id="cb30-55"><a href="#cb30-55"></a>has_children <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb30-56"><a href="#cb30-56"></a>  <span class="sc">!</span><span class="fu">is.null</span>(x<span class="sc">$</span>children) <span class="sc">&amp;&amp;</span> <span class="fu">length</span>(x<span class="sc">$</span>children) <span class="sc">&gt;</span> <span class="dv">0</span></span>
<span id="cb30-57"><a href="#cb30-57"></a>}</span>
<span id="cb30-58"><a href="#cb30-58"></a></span>
<span id="cb30-59"><a href="#cb30-59"></a>compress_or_skip <span class="ot">&lt;-</span> <span class="cf">function</span>(tree, location) {</span>
<span id="cb30-60"><a href="#cb30-60"></a>  <span class="cf">if</span> (<span class="fu">has_children</span>(tree[[location <span class="sc">-</span> <span class="dv">1</span>]])) {</span>
<span id="cb30-61"><a href="#cb30-61"></a>    n <span class="ot">&lt;-</span> <span class="fu">length</span>(tree[[location <span class="sc">-</span> <span class="dv">1</span>]]<span class="sc">$</span>children)</span>
<span id="cb30-62"><a href="#cb30-62"></a>    <span class="cf">if</span> (tree[[location <span class="sc">-</span> <span class="dv">1</span>]]<span class="sc">$</span>children[[n]]<span class="sc">$</span>parent<span class="sc">$</span>kind <span class="sc">==</span> <span class="st">"Missing"</span>) {</span>
<span id="cb30-63"><a href="#cb30-63"></a>      tree[[location <span class="sc">-</span> <span class="dv">1</span>]]<span class="sc">$</span>children[[n]] <span class="ot">&lt;-</span> tree[[location]]</span>
<span id="cb30-64"><a href="#cb30-64"></a>      tree[[location]] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb30-65"><a href="#cb30-65"></a>    }</span>
<span id="cb30-66"><a href="#cb30-66"></a>  }</span>
<span id="cb30-67"><a href="#cb30-67"></a>  <span class="fu">return</span>(tree)</span>
<span id="cb30-68"><a href="#cb30-68"></a>}</span>
<span id="cb30-69"><a href="#cb30-69"></a></span>
<span id="cb30-70"><a href="#cb30-70"></a>compress_tree <span class="ot">&lt;-</span> <span class="cf">function</span>(tree) {</span>
<span id="cb30-71"><a href="#cb30-71"></a>  <span class="cf">if</span> (<span class="fu">length</span>(tree) <span class="sc">&lt;=</span> <span class="dv">1</span>) {</span>
<span id="cb30-72"><a href="#cb30-72"></a>    <span class="fu">return</span>(tree)</span>
<span id="cb30-73"><a href="#cb30-73"></a>  }</span>
<span id="cb30-74"><a href="#cb30-74"></a></span>
<span id="cb30-75"><a href="#cb30-75"></a>  <span class="co"># Compress branches of the top-level tree</span></span>
<span id="cb30-76"><a href="#cb30-76"></a>  loc <span class="ot">&lt;-</span> <span class="fu">length</span>(tree)</span>
<span id="cb30-77"><a href="#cb30-77"></a>  <span class="cf">while</span> (loc <span class="sc">&gt;</span> <span class="dv">1</span>) {</span>
<span id="cb30-78"><a href="#cb30-78"></a>    tree <span class="ot">&lt;-</span> <span class="fu">compress_or_skip</span>(tree, loc)</span>
<span id="cb30-79"><a href="#cb30-79"></a>    loc <span class="ot">&lt;-</span> loc <span class="sc">-</span> <span class="dv">1</span></span>
<span id="cb30-80"><a href="#cb30-80"></a>  }</span>
<span id="cb30-81"><a href="#cb30-81"></a></span>
<span id="cb30-82"><a href="#cb30-82"></a>  <span class="co"># Recursively compress branches of children subtrees</span></span>
<span id="cb30-83"><a href="#cb30-83"></a>  <span class="cf">for</span> (loc <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(tree)) {</span>
<span id="cb30-84"><a href="#cb30-84"></a>    tree[[loc]]<span class="sc">$</span>children <span class="ot">&lt;-</span> <span class="fu">compress_tree</span>(tree[[loc]]<span class="sc">$</span>children)</span>
<span id="cb30-85"><a href="#cb30-85"></a>  }</span>
<span id="cb30-86"><a href="#cb30-86"></a></span>
<span id="cb30-87"><a href="#cb30-87"></a>  <span class="fu">return</span>(tree)</span>
<span id="cb30-88"><a href="#cb30-88"></a>}</span>
<span id="cb30-89"><a href="#cb30-89"></a></span>
<span id="cb30-90"><a href="#cb30-90"></a>parse <span class="ot">&lt;-</span> <span class="cf">function</span>(text) {</span>
<span id="cb30-91"><a href="#cb30-91"></a>  tree <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb30-92"><a href="#cb30-92"></a>  tokens <span class="ot">&lt;-</span> <span class="fu">tokenize</span>(text)</span>
<span id="cb30-93"><a href="#cb30-93"></a>  <span class="cf">for</span>(token <span class="cf">in</span> tokens) {</span>
<span id="cb30-94"><a href="#cb30-94"></a>    tree <span class="ot">&lt;-</span> <span class="fu">update_tree</span>(tree, token)</span>
<span id="cb30-95"><a href="#cb30-95"></a>  }</span>
<span id="cb30-96"><a href="#cb30-96"></a>  tree <span class="ot">&lt;-</span> <span class="fu">compress_tree</span>(tree)</span>
<span id="cb30-97"><a href="#cb30-97"></a>  <span class="fu">class</span>(tree) <span class="ot">&lt;-</span> <span class="st">"token_list"</span> <span class="co"># allows pretty printing</span></span>
<span id="cb30-98"><a href="#cb30-98"></a>  <span class="fu">return</span>(tree)</span>
<span id="cb30-99"><a href="#cb30-99"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"token_class.R"</span>)</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"parse_class.R"</span>)</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"tokenizer_2.R"</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">"parser_2.R"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parse</span>(<span class="st">"^caa*t$"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Token at 1&gt; Start
&lt;Token at 2&gt; Literal: c
&lt;Token at 3&gt; Literal: a
&lt;Token at 5&gt; Any
     &lt;Token at 4&gt; Literal: a
&lt;Token at 6&gt; Literal: t
&lt;Token at 7&gt; End</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parse</span>(<span class="st">"aa|b"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Token at 1&gt; Literal: a
&lt;Token at 3&gt; Or
     &lt;Token at 2&gt; Literal: a
     &lt;Token at 4&gt; Literal: b</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parse</span>(<span class="st">"(ab)|c"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Token at 5&gt; Or
     &lt;Token at 1&gt; Group
          &lt;Token at 2&gt; Literal: a
          &lt;Token at 3&gt; Literal: b
     &lt;Token at 6&gt; Literal: c</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parse</span>(<span class="st">"^(caa*t)|(dog)$"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Token at 1&gt; Start
&lt;Token at 9&gt; Or
     &lt;Token at 2&gt; Group
          &lt;Token at 3&gt; Literal: c
          &lt;Token at 4&gt; Literal: a
          &lt;Token at 6&gt; Any
               &lt;Token at 5&gt; Literal: a
          &lt;Token at 7&gt; Literal: t
     &lt;Token at 10&gt; Group
          &lt;Token at 11&gt; Literal: d
          &lt;Token at 12&gt; Literal: o
          &lt;Token at 13&gt; Literal: g
&lt;Token at 15&gt; End</code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parse</span>(<span class="st">"ab|((cd*)|ef)|g"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Token at 1&gt; Literal: a
&lt;Token at 3&gt; Or
     &lt;Token at 2&gt; Literal: b
     &lt;Token at 14&gt; Or
          &lt;Token at 4&gt; Group
               &lt;Token at 10&gt; Or
                    &lt;Token at 5&gt; Group
                         &lt;Token at 6&gt; Literal: c
                         &lt;Token at 8&gt; Any
                              &lt;Token at 7&gt; Literal: d
                    &lt;Token at 11&gt; Literal: e
               &lt;Token at 12&gt; Literal: f
          &lt;Token at 15&gt; Literal: g</code></pre>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parse</span>(<span class="st">"x|(y|z)z"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Token at 2&gt; Or
     &lt;Token at 1&gt; Literal: x
     &lt;Token at 3&gt; Group
          &lt;Token at 5&gt; Or
               &lt;Token at 4&gt; Literal: y
               &lt;Token at 6&gt; Literal: z
&lt;Token at 8&gt; Literal: z</code></pre>
</div>
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">parse</span>(<span class="st">"x|(y|z)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>&lt;Token at 2&gt; Or
     &lt;Token at 1&gt; Literal: x
     &lt;Token at 3&gt; Group
          &lt;Token at 5&gt; Or
               &lt;Token at 4&gt; Literal: y
               &lt;Token at 6&gt; Literal: z</code></pre>
</div>
</div>


</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div id="quarto-reuse" class="quarto-appendix-contents"><div><a rel="license" href="https://creativecommons.org/licenses/by/4.0/">https://creativecommons.org/licenses/by/4.0/</a></div></div></section><section class="quarto-appendix-contents"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{navarro2023,
  author = {Navarro, Danielle},
  title = {Software Design by Example},
  date = {2023-05-28},
  url = {https://blog.djnavarro.net/posts/2023-05-28_software-design-by-example},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-navarro2023" class="csl-entry quarto-appendix-citeas" role="listitem">
Navarro, Danielle. 2023. <span>“Software Design by Example.”</span> May
28, 2023. <a href="https://blog.djnavarro.net/posts/2023-05-28_software-design-by-example">https://blog.djnavarro.net/posts/2023-05-28_software-design-by-example</a>.
</div></div></section></div></main> <!-- /main -->
<!-- plausible -->
<script async="" defer="" data-domain="blog.djnavarro.net" src="https://plausible.io/js/plausible.js"></script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
      &nbsp;
    </div>   
    <div class="nav-footer-center">
      <ul class="footer-items list-unstyled">
    <li class="nav-item">
    <a class="nav-link" href="https://blog.djnavarro.net">blog.djnavarro.net</a>
  </li>  
</ul>
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>



</body></html>