{
  "hash": "ee03f61ef38ae8c792aa4830cec0c06e",
  "result": {
    "markdown": "---\ntitle: \"Crayola crayon colours\"\nauthor:\n  - name: Danielle Navarro\n    url: https://djnavarro.net\n    affiliation: I'm on smoko\n    affiliation-url: https://www.youtube.com/watch?v=j58V2vC9EPc\n    orcid: 0000-0001-7648-6578\ndescription: \"Am I bored in the house? Yes. And am I in the house bored? Also yes. But do I have rvest and a stubborn desire not to allow the horrors of 'data encoded in the CSS style' to defeat me? Oh my yes\"\ndate: \"2022-12-18\"\ncategories: [R, rvest]\nimage: \"crayola.png\"\n---\n\n\n<!--------------- my typical setup ----------------->\n\n\n\n\n\n\n<!--------------- post begins here ----------------->\n\nWhat am I doing? Why am I here? Oh that's right. So I was having coffee this morning reading the nerd news on mastodon as a girl likes to do and this [this very cool post about crayon colours](https://mas.to/@kims/109525496705672156) by Kim Scheinberg caught my attention. \n\n![](crayola_toot.jpg){fig-align=\"center\" width=\"75%\"}\n\nThe image comes from [this blog post](http://www.datapointed.net/2010/01/crayola-crayon-color-chart/) by Stephen Von Worley -- he has a [follow up](http://www.datapointed.net/2010/10/crayola-color-chart-rainbow-style/) too. Interesting. I realise I am of course about to waste half a day on this...\n\n## It's the prologue, baby\n\nHaving read the blog posts by Von Worley I worked out that the source of the data is the Wikipedia [list of Crayola crayon colours](https://en.wikipedia.org/wiki/List_of_Crayola_crayon_colors), and as it happens I know how to pull data from Wikipedia tables into R. Thanks to [this amazing post](https://ivelasq.rbind.io/blog/politely-scraping/) by Isabella Velásquez, I'd learned all about using the [polite](https://dmi3kno.github.io/polite/) package to make sure that my webscraping is appropriate and respectful, and using the [rvest](https://rvest.tidyverse.org/) package to do the actual scraping. What I had assumed, is that reading the table into R was going to be a simple matter of writing some code like this...\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <- \"https://en.wikipedia.org/wiki/List_of_Crayola_crayon_colors\"\nraw <- url |>\n  polite::bow() |>\n  polite::scrape() |>\n  rvest::html_nodes(\"table.wikitable\")\n```\n:::\n\n\nThis scrapes all the tables from the page, but I only want the first one. That's the big table with the listing of Crayola's standard colours. The table itself looks a little like this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nraw[[1]]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n{html_node}\n<table class=\"wikitable sortable\">\n[1] <caption>\\n</caption>\n[2] <tbody>\\n<tr>\\n<th width=\"10%\" class=\"sortable\">Color\\n</th>\\n<th wid ...\n```\n:::\n:::\n\n\nI don't want to parse the html myself, but the hope is that I can use something like the `html_table()` function to extract the table and return a data frame. Okay, let's give it a go...\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncrayola <- raw |>\n  purrr::pluck(1) |>\n  rvest::html_table()\n```\n:::\n\n\nWell it hasn't thrown an error, but when I look at the `crayola` data frame...\n\n\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\ncrayola\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 168 × 9\n   Color Name                    `Hexadecimal in their website depiction[b]` Years in production…¹ Notes 16-Bo…² 24-Bo…³ 32-Bo…⁴ 64-Bo…⁵\n   <lgl> <chr>                   <chr>                                       <chr>                 <chr> <chr>   <chr>   <chr>   <chr>  \n 1 NA    Red                     \"#ED0A3F\"                                   1903–present          \"\"    \"Yes\"   \"Yes\"   \"Yes\"   \"Yes\"  \n 2 NA    Maroon                  \"#C32148\"                                   1949–present          \"Kno… \"No\"    \"No\"    \"No\"    \"No\"   \n 3 NA    Scarlet                 \"#FD0E35\"                                   1998–present          \"Kno… \"No\"    \"Yes\"   \"Yes\"   \"Yes\"  \n 4 NA    Brick Red               \"#C62D42\"                                   1958–present          \"\"    \"No\"    \"No\"    \"No\"    \"Yes\"  \n 5 NA    English Vermilion       \"\"                                          1903–1935             \"Als… \"\"      \"\"      \"\"      \"\"     \n 6 NA    Madder Lake             \"\"                                          1903–1935             \"\"    \"\"      \"\"      \"\"      \"\"     \n 7 NA    Permanent Geranium Lake \"\"                                          1903–circa 1910       \"\"    \"\"      \"\"      \"\"      \"\"     \n 8 NA    Maximum Red             \"\"                                          1926–1944             \"Par… \"\"      \"\"      \"\"      \"\"     \n 9 NA    Chestnut                \"#B94E48\"                                   1903–present          \"Kno… \"No\"    \"No\"    \"Yes\"   \"Yes\"  \n10 NA    Orange-Red              \"#FF5349\"                                   1958–1990             \"\"    \"\"      \"\"      \"\"      \"\"     \n# … with 158 more rows, and abbreviated variable names ¹​`Years in production[2]`, ²​`16-Box`, ³​`24-Box`, ⁴​`32-Box`, ⁵​`64-Box`\n```\n:::\n:::\n\n\n\n\n... I encounter a rather awkward problem. The `colour` field, which renders on the Wikipedia page as a pretty block of colour showing what the crayon colour looks like, is empty. Sure, I do have text containing hex codes for some of the crayons, but the missing data isn't missing at random. Old crayon colours are the ones systematically missing an official hex code. Okay, so I really would like to have some data in my `colour` column.\n\n## Act I: I think it works like the hanky code\n\nLook, that's not a big deal right? Not having any colours for a post about colours? I guess the post will be short. Eh. Let's set that aside and focus on the important things. Those column names need a little cleaning: \n\n\n::: {.cell}\n\n```{.r .cell-code}\ncrayola <- crayola |>\n  janitor::clean_names() |>\n  dplyr::rename(\n    listed = hexadecimal_in_their_website_depiction_b,\n    years = years_in_production_2\n  )\n```\n:::\n\n\nMuch nicer:\n\n\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\ncrayola\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 168 × 9\n   color name                    listed    years           notes                                     x16_box x24_box x32_box x64_box\n   <lgl> <chr>                   <chr>     <chr>           <chr>                                     <chr>   <chr>   <chr>   <chr>  \n 1 NA    Red                     \"#ED0A3F\" 1903–present    \"\"                                        \"Yes\"   \"Yes\"   \"Yes\"   \"Yes\"  \n 2 NA    Maroon                  \"#C32148\" 1949–present    \"Known as \\\"Dark Red\\\", 1949–1958.[2]\"    \"No\"    \"No\"    \"No\"    \"No\"   \n 3 NA    Scarlet                 \"#FD0E35\" 1998–present    \"Known as \\\"Torch Red\\\", 1998.[2]\"        \"No\"    \"Yes\"   \"Yes\"   \"Yes\"  \n 4 NA    Brick Red               \"#C62D42\" 1958–present    \"\"                                        \"No\"    \"No\"    \"No\"    \"Yes\"  \n 5 NA    English Vermilion       \"\"        1903–1935       \"Also spelled \\\"Vermillion\\\".[2]\"         \"\"      \"\"      \"\"      \"\"     \n 6 NA    Madder Lake             \"\"        1903–1935       \"\"                                        \"\"      \"\"      \"\"      \"\"     \n 7 NA    Permanent Geranium Lake \"\"        1903–circa 1910 \"\"                                        \"\"      \"\"      \"\"      \"\"     \n 8 NA    Maximum Red             \"\"        1926–1944       \"Part of the Munsell line.[2]\"            \"\"      \"\"      \"\"      \"\"     \n 9 NA    Chestnut                \"#B94E48\" 1903–present    \"Known as \\\"Indian Red\\\" before 1999.[2]\" \"No\"    \"No\"    \"Yes\"   \"Yes\"  \n10 NA    Orange-Red              \"#FF5349\" 1958–1990       \"\"                                        \"\"      \"\"      \"\"      \"\"     \n# … with 158 more rows\n```\n:::\n:::\n\n\n\n\nNow where was I? What's that maxim about never using background colour to encode substantive data in a table? I seem to have run afoul of that. Let's take a look at the elements of the html table and see if I can work out where things went wrong...\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncells <- raw[[1]] |> rvest::html_elements(\"td\")\ncells\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n{xml_nodeset (1512)}\n [1] <td style=\"background: #ED0A3F; color: white\"> \\n</td>\n [2] <td>Red\\n</td>\n [3] <td align=\"center\" style=\"background:#E9E9E9\">#ED0A3F\\n</td>\n [4] <td>1903–present\\n</td>\n [5] <td>\\n</td>\n [6] <td style=\"background:#9EFF9E;vertical-align:middle;text-align:cente ...\n [7] <td style=\"background:#9EFF9E;vertical-align:middle;text-align:cente ...\n [8] <td style=\"background:#9EFF9E;vertical-align:middle;text-align:cente ...\n [9] <td style=\"background:#9EFF9E;vertical-align:middle;text-align:cente ...\n[10] <td style=\"background: #C32148; color: white\"> \\n</td>\n[11] <td>Maroon\\n</td>\n[12] <td align=\"center\" style=\"background:#E9E9E9\">#C32148\\n</td>\n[13] <td>\\n<a href=\"/wiki/1949\" title=\"1949\">1949</a>–present\\n</td>\n[14] <td>Known as \"Dark Red\", 1949–1958.<sup id=\"cite_ref-WelterColorName ...\n[15] <td style=\"background:#FFC7C7;vertical-align:middle;text-align:cente ...\n[16] <td style=\"background:#FFC7C7;vertical-align:middle;text-align:cente ...\n[17] <td style=\"background:#FFC7C7;vertical-align:middle;text-align:cente ...\n[18] <td style=\"background:#FFC7C7;vertical-align:middle;text-align:cente ...\n[19] <td style=\"background: #FD0E35; color: white\"> \\n</td>\n[20] <td>Scarlet\\n</td>\n...\n```\n:::\n:::\n\n\nOkay yeah. You can see the problem looking at the 1st and 10th line of the output here. The piece of information we need is embedded in the css style attribute, and it's *only* in the style metadata attribute. There's no data in the actual \"td\" element for `html_table()` to capture. I'm going to have to fix that myself I guess. Sigh.\n\nThe first part of my process was to find the relevant subset of cells. There's probably a better way to do it, but my approach was based on noting that (a) it's really easy to find the cells containing the colour names (\"Red\", \"Maroon\", etc), and (b) the cell to the left of it is always the one that has the background colour that I'm looking for. So, my first step was to manually pull out the text in each cell. That's easy to do with rvest thanks to the `html_text()` function, and just to make my life a little easier I used stringr to remove all the `\\n` characters at the end of each cell:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncell_text <- cells |>\n  rvest::html_text() |>\n  stringr::str_remove_all(\"\\n$\")\n```\n:::\n\n\nAnd here's the text in the first 20 cells:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncell_text[1:20]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \" \"                                   \n [2] \"Red\"                                 \n [3] \"#ED0A3F\"                             \n [4] \"1903–present\"                        \n [5] \"\"                                    \n [6] \"Yes\"                                 \n [7] \"Yes\"                                 \n [8] \"Yes\"                                 \n [9] \"Yes\"                                 \n[10] \" \"                                   \n[11] \"Maroon\"                              \n[12] \"#C32148\"                             \n[13] \"1949–present\"                        \n[14] \"Known as \\\"Dark Red\\\", 1949–1958.[2]\"\n[15] \"No\"                                  \n[16] \"No\"                                  \n[17] \"No\"                                  \n[18] \"No\"                                  \n[19] \" \"                                   \n[20] \"Scarlet\"                             \n```\n:::\n:::\n\n\nSo when I now match this text against the colour names stored in `crayola$name`, I'll detect \"Red\" in cell 2, \"Maroon\" in cell 11, and so on. If I subtract 1 from each of these values, I now have the indices of the table cells that contain the style information I need.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nind <- which(cell_text %in% crayola$name) - 1\n```\n:::\n\n\nHere's what those cells look like:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncells[ind]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n{xml_nodeset (168)}\n [1] <td style=\"background: #ED0A3F; color: white\"> \\n</td>\n [2] <td style=\"background: #C32148; color: white\"> \\n</td>\n [3] <td style=\"background: #FD0E35; color: white\"> \\n</td>\n [4] <td style=\"background: #C62D42; color: white\"> \\n</td>\n [5] <td style=\"background: #CC474B; color: white\"> \\n</td>\n [6] <td style=\"background: #CC3336; color: white\"> \\n</td>\n [7] <td style=\"background: #E12C2C; color: white\"> \\n</td>\n [8] <td style=\"background: #D92121; color: white\"> \\n</td>\n [9] <td style=\"background: #B94E48; color: white\"> \\n</td>\n[10] <td style=\"background: #FF5349; color: white\"> \\n</td>\n[11] <td style=\"background: #FE4C40; color: white\"> \\n</td>\n[12] <td style=\"background: #FE6F5E; color: white\"> \\n</td>\n[13] <td style=\"background: #B33B24; color: white\"> \\n</td>\n[14] <td style=\"background: #CC553D; color: white\"> \\n</td>\n[15] <td style=\"background: #E6735C; color: white\"> \\n</td>\n[16] <td style=\"background: #FF9980; color: white\"> \\n</td>\n[17] <td style=\"background: #E58E73; color: white\"> \\n</td>\n[18] <td style=\"background: #FF7034; color: white\"> \\n</td>\n[19] <td style=\"background: #FF681F; color: white\"> \\n</td>\n[20] <td style=\"background: #FF8833; color: white\"> \\n</td>\n...\n```\n:::\n:::\n\n\nThat's much nicer. Now I have something with a consistent format that I can process without too much pain. The rvest package has a `html_attr()` function which I can use to pull out the contents of the style attribute as a string. So, after spending a few minutes trying to remember how regular expressions work, I used `str_extract()` to pull out the hexadecimal codes like this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbackground <- cells[ind] |>\n  rvest::html_attr(\"style\") |>\n  stringr::str_extract(\"#[0-9ABCDEF]{6}\")\n```\n:::\n\n\nLet's take a look:\n\n\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\nbackground\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  [1] \"#ED0A3F\" \"#C32148\" \"#FD0E35\" \"#C62D42\" \"#CC474B\" \"#CC3336\" \"#E12C2C\" \"#D92121\" \"#B94E48\" \"#FF5349\" \"#FE4C40\" \"#FE6F5E\" \"#B33B24\"\n [14] \"#CC553D\" \"#E6735C\" \"#FF9980\" \"#E58E73\" \"#FF7034\" \"#FF681F\" \"#FF8833\" \"#FFB97B\" \"#ECAC76\" \"#E77200\" \"#FFAE42\" \"#F2BA49\" \"#FBE7B2\"\n [27] \"#F2C649\" \"#F8D568\" \"#FCD667\" \"#FED85D\" \"#FBE870\" \"#F1E788\" \"#FFEB00\" \"#B5B35C\" \"#ECEBBD\" \"#FAFA37\" \"#FFFF99\" \"#FFFF9F\" \"#D9E650\"\n [40] \"#ACBF60\" \"#AFE313\" \"#BEE64B\" \"#C5E17A\" \"#5E8C31\" \"#7BA05B\" \"#9DE093\" \"#63B76C\" \"#4D8C57\" \"#01A638\" \"#6CA67C\" \"#5FA777\" \"#93DFB8\"\n [53] \"#33CC99\" \"#1AB385\" \"#29AB87\" \"#00CC99\" \"#00755E\" \"#8DD9CC\" \"#01796F\" \"#30BFBF\" \"#00CCCC\" \"#008080\" \"#8FD8D8\" \"#95E0E8\" \"#6CDAE7\"\n [66] \"#2D383A\" \"#76D7EA\" \"#7ED4E6\" \"#0095B7\" \"#009DC4\" \"#02A4D3\" \"#47ABCC\" \"#2EB4E6\" \"#339ACC\" \"#93CCEA\" \"#2887C8\" \"#003366\" \"#0066CC\"\n [79] \"#1560BD\" \"#0066FF\" \"#A9B2C3\" \"#C3CDE6\" \"#4570E6\" \"#3C69E7\" \"#7A89B8\" \"#4F69C6\" \"#8D90A1\" \"#8C90C8\" \"#7070CC\" \"#9999CC\" \"#ACACE6\"\n [92] \"#766EC8\" \"#6456B7\" \"#3F26BF\" \"#8B72BE\" \"#652DC1\" \"#6B3FA0\" \"#8359A3\" \"#8F47B3\" \"#C9A0DC\" \"#BF8FCC\" \"#803790\" \"#733380\" \"#D6AEDD\"\n[105] \"#C154C1\" \"#FC74FD\" \"#732E6C\" \"#E667CE\" \"#E29CD2\" \"#8E3179\" \"#D96CBE\" \"#D8BFD8\" \"#C8509B\" \"#BB3385\" \"#D982B5\" \"#A63A79\" \"#A50B5E\"\n[118] \"#614051\" \"#F653A6\" \"#DA3287\" \"#FF3399\" \"#FBAED2\" \"#FFB7D5\" \"#FFA6C9\" \"#F7468A\" \"#E30B5C\" \"#FDD7E4\" \"#E62E6B\" \"#DB5079\" \"#FC80A5\"\n[131] \"#F091A9\" \"#FF91A4\" \"#A55353\" \"#CA3435\" \"#FEBAAD\" \"#F7A38E\" \"#E97451\" \"#AF593E\" \"#9E5B40\" \"#87421F\" \"#926F5B\" \"#DEA681\" \"#D27D46\"\n[144] \"#664228\" \"#FA9D5A\" \"#EDC9AF\" \"#FFCBA4\" \"#805533\" \"#FDD5B1\" \"#EED9C4\" \"#665233\" \"#837050\" \"#E6BC5C\" \"#92926E\" \"#E6BE8A\" \"#C9C0BB\"\n[157] \"#DA8A67\" \"#C88A65\" \"#000000\" \"#736A62\" \"#8B8680\" \"#C8C8CD\" \"#D9D6CF\" \"#FFFFFF\" \"#F1D651\" \"#DDEBEC\" \"#D9DAD2\" \"#C0D5F0\"\n```\n:::\n:::\n\n\n\n\nYay, those look like hex colours. Better yet, because I've been careful to ensure that I've matched everything to the correct colours and in the correct order, I can insert them into the `crayola` tibble where they should have been in the first place:\n\n\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\ncrayola$color <- background\ncrayola\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 168 × 9\n   color   name                    listed    years           notes                                     x16_box x24_box x32_box x64_box\n   <chr>   <chr>                   <chr>     <chr>           <chr>                                     <chr>   <chr>   <chr>   <chr>  \n 1 #ED0A3F Red                     \"#ED0A3F\" 1903–present    \"\"                                        \"Yes\"   \"Yes\"   \"Yes\"   \"Yes\"  \n 2 #C32148 Maroon                  \"#C32148\" 1949–present    \"Known as \\\"Dark Red\\\", 1949–1958.[2]\"    \"No\"    \"No\"    \"No\"    \"No\"   \n 3 #FD0E35 Scarlet                 \"#FD0E35\" 1998–present    \"Known as \\\"Torch Red\\\", 1998.[2]\"        \"No\"    \"Yes\"   \"Yes\"   \"Yes\"  \n 4 #C62D42 Brick Red               \"#C62D42\" 1958–present    \"\"                                        \"No\"    \"No\"    \"No\"    \"Yes\"  \n 5 #CC474B English Vermilion       \"\"        1903–1935       \"Also spelled \\\"Vermillion\\\".[2]\"         \"\"      \"\"      \"\"      \"\"     \n 6 #CC3336 Madder Lake             \"\"        1903–1935       \"\"                                        \"\"      \"\"      \"\"      \"\"     \n 7 #E12C2C Permanent Geranium Lake \"\"        1903–circa 1910 \"\"                                        \"\"      \"\"      \"\"      \"\"     \n 8 #D92121 Maximum Red             \"\"        1926–1944       \"Part of the Munsell line.[2]\"            \"\"      \"\"      \"\"      \"\"     \n 9 #B94E48 Chestnut                \"#B94E48\" 1903–present    \"Known as \\\"Indian Red\\\" before 1999.[2]\" \"No\"    \"No\"    \"Yes\"   \"Yes\"  \n10 #FF5349 Orange-Red              \"#FF5349\" 1958–1990       \"\"                                        \"\"      \"\"      \"\"      \"\"     \n# … with 158 more rows\n```\n:::\n:::\n\n\n\n\n\nFinally!\n\n## Act II: One hundred years of tidyr\n\nIf life were at all fair my data wrangling woes would now be over, but of course they are not. If I'm going to analyse the Crayola data by year it will be useful to me if the `year` column has nicely formatted data, and of course it does not:\n\n\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\ncrayola$years\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  [1] \"1903–present\"               \"1949–present\"               \"1998–present\"               \"1958–present\"              \n  [5] \"1903–1935\"                  \"1903–1935\"                  \"1903–circa 1910\"            \"1926–1944\"                 \n  [9] \"1903–present\"               \"1958–1990\"                  \"1997–present\"               \"1958–present\"              \n [13] \"1903–circa 1910\"            \"1903–1944\"                  \"1903–circa 1910\"            \"1990–present\"              \n [17] \"1926–1944\"                  \"1958–present\"               \"1930–present\"               \"1903–present\"              \n [21] \"1993–present\"               \"1926–1944, 1949–1958\"       \"2003–present\"               \"1930–present\"              \n [25] \"1926–1944\"                  \"1998–present\"               \"1903–1990\"                  \"1958–1990\"                 \n [29] \"1903–present\"               \"1990–2017[2][3][4]\"         \"1903–present\"               \"1958–present\"              \n [33] \"1926–1944\"                  \"1903–present\"               \"1958–present\"               \"1926–1944\"                 \n [37] \"1998–present\"               \"1903–1990\"                  \"1926–1944\"                  \"1926–1944\"                 \n [41] \"2003–present\"               \"1903–1935\"                  \"1930–present\"               \"1926–1944\"                 \n [45] \"1993–present\"               \"1993–present\"               \"1998–present\"               \"1926–1944\"                 \n [49] \"1903–present\"               \"1903–1939\"                  \"1949–present\"               \"1949–present\"              \n [53] \"1993–present\"               \"1998–present\"               \"1990–present\"               \"1997–present\"              \n [57] \"1993–present\"               \"1926–1944\"                  \"1903–1949, 1958–present\"    \"1926–1944\"                 \n [61] \"1993–present\"               \"1990–2003\"                  \"1958\"                       \"1949–present\"              \n [65] \"1935–present\"               \"1998–present\"               \"1958–present\"               \"1926–1944\"                 \n [69] \"1949–present\"               \"1993–present\"               \"1990–present\"               \"1926–1958\"                 \n [73] \"1903–1958\"                  \"1949–1958\"                  \"1958–present\"               \"1958–1990\"                 \n [77] \"1903–present\"               \"1958–present\"               \"1993–present\"               \"1949–present\"              \n [81] \"1958–present\"               \"1958–present\"               \"1935–1958\"                  \"2017–present[5]\"           \n [85] \"2003–present\"               \"1999–present\"               \"1998–present\"               \"1903–1958\"                 \n [89] \"1903–circa 1910\"            \"1998–present\"               \"1926–1944\"                  \"1903–circa 1910, 1930–1990\"\n [93] \"1949–present\"               \"1903–1944\"                  \"1926–1944\"                  \"1998–present\"              \n [97] \"1990–present\"               \"1930–1949, 1958–present\"    \"1949–1958\"                  \"1993–present\"              \n[101] \"1949–1958\"                  \"1997–present\"               \"1926–1944\"                  \"1993–present\"              \n[105] \"1990–present\"               \"1997–present\"               \"1903–1930\"                  \"1949–1958\"                 \n[109] \"1949–present\"               \"1958–present\"               \"1949–1958\"                  \"1949–1999\"                 \n[113] \"1958–2003\"                  \"1930–present\"               \"1926–1944\"                  \"1926–1944\"                 \n[117] \"2003–present\"               \"1998–present\"               \"1903–present\"               \"1993–present\"              \n[121] \"1990–present\"               \"1958–present\"               \"1998–present\"               \"1903–present\"              \n[125] \"1958–present\"               \"1993–present\"               \"1998–present\"               \"1935–1958\"                 \n[129] \"1998–present\"               \"1993–present\"               \"1993–present\"               \"1949–present\"              \n[133] \"1926–1944\"                  \"1949–present\"               \"1958–present\"               \"1998–present\"              \n[137] \"1903–present\"               \"1903–present\"               \"1935–1944, 1958–present\"    \"1998–present\"              \n[141] \"1998–present\"               \"1993–present\"               \"1958–present\"               \"1903–1910\"                 \n[145] \"1958–present\"               \"1998–present\"               \"1903–present\"               \"1903–1944\"                 \n[149] \"1958–present\"               \"1998–present\"               \"1903–1990\"                  \"1998–present\"              \n[153] \"1903–circa 1910\"            \"1903–1944\"                  \"1953–present\"               \"1903–present\"              \n[157] \"1903–1915, 1958–present\"    \"1998–present\"               \"1903–present\"               \"1903–1910\"                 \n[161] \"1926–present\"               \"1958–1990\"                  \"1993–present\"               \"1903–present\"              \n[165] \"2021, 2022\"                 \"2021, 2022\"                 \"2021, 2022\"                 \"2021, 2022\"                \n```\n:::\n:::\n\n\n\n\n\nThere are several problems I'm going to need to solve to get this into a regular form:\n\n- The \"circa\" text will have to be removed\n- White spaces will need to be removed\n- Footnote text will need to be removed\n- The word \"present\" will have to be replaced by \"2022\"\n- The single year \"1958\" will need to be replaced by an interval \"1958-1958\"\n- The comma separated list \"2021,2022\" will need to be an interval \"2021-2022\"\n\nHere's a little bit of stringr code that does that:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncrayola <- crayola |>\n  dplyr::mutate(\n    years = years |>\n      stringr::str_remove_all(\" \") |>\n      stringr::str_remove_all(\"\\\\[.\\\\]\") |>\n      stringr::str_remove_all(\"circa\") |>\n      stringr::str_replace_all(\"present\", \"2022\") |>\n      stringr::str_replace_all(\"^1958$\", \"1958-1958\") |>\n      stringr::str_replace_all(\"2021,2022\", \"2021-2022\"),\n  ) \n```\n:::\n\n\nThe `years` column now has a regular form. Each entry is either a contiguous interval like \"1903-2022\", or a comma separated list of two such intervals like \"1903–1910,1930–1990\":\n\n\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\ncrayola$years\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n  [1] \"1903–2022\"           \"1949–2022\"           \"1998–2022\"           \"1958–2022\"           \"1903–1935\"          \n  [6] \"1903–1935\"           \"1903–1910\"           \"1926–1944\"           \"1903–2022\"           \"1958–1990\"          \n [11] \"1997–2022\"           \"1958–2022\"           \"1903–1910\"           \"1903–1944\"           \"1903–1910\"          \n [16] \"1990–2022\"           \"1926–1944\"           \"1958–2022\"           \"1930–2022\"           \"1903–2022\"          \n [21] \"1993–2022\"           \"1926–1944,1949–1958\" \"2003–2022\"           \"1930–2022\"           \"1926–1944\"          \n [26] \"1998–2022\"           \"1903–1990\"           \"1958–1990\"           \"1903–2022\"           \"1990–2017\"          \n [31] \"1903–2022\"           \"1958–2022\"           \"1926–1944\"           \"1903–2022\"           \"1958–2022\"          \n [36] \"1926–1944\"           \"1998–2022\"           \"1903–1990\"           \"1926–1944\"           \"1926–1944\"          \n [41] \"2003–2022\"           \"1903–1935\"           \"1930–2022\"           \"1926–1944\"           \"1993–2022\"          \n [46] \"1993–2022\"           \"1998–2022\"           \"1926–1944\"           \"1903–2022\"           \"1903–1939\"          \n [51] \"1949–2022\"           \"1949–2022\"           \"1993–2022\"           \"1998–2022\"           \"1990–2022\"          \n [56] \"1997–2022\"           \"1993–2022\"           \"1926–1944\"           \"1903–1949,1958–2022\" \"1926–1944\"          \n [61] \"1993–2022\"           \"1990–2003\"           \"1958-1958\"           \"1949–2022\"           \"1935–2022\"          \n [66] \"1998–2022\"           \"1958–2022\"           \"1926–1944\"           \"1949–2022\"           \"1993–2022\"          \n [71] \"1990–2022\"           \"1926–1958\"           \"1903–1958\"           \"1949–1958\"           \"1958–2022\"          \n [76] \"1958–1990\"           \"1903–2022\"           \"1958–2022\"           \"1993–2022\"           \"1949–2022\"          \n [81] \"1958–2022\"           \"1958–2022\"           \"1935–1958\"           \"2017–2022\"           \"2003–2022\"          \n [86] \"1999–2022\"           \"1998–2022\"           \"1903–1958\"           \"1903–1910\"           \"1998–2022\"          \n [91] \"1926–1944\"           \"1903–1910,1930–1990\" \"1949–2022\"           \"1903–1944\"           \"1926–1944\"          \n [96] \"1998–2022\"           \"1990–2022\"           \"1930–1949,1958–2022\" \"1949–1958\"           \"1993–2022\"          \n[101] \"1949–1958\"           \"1997–2022\"           \"1926–1944\"           \"1993–2022\"           \"1990–2022\"          \n[106] \"1997–2022\"           \"1903–1930\"           \"1949–1958\"           \"1949–2022\"           \"1958–2022\"          \n[111] \"1949–1958\"           \"1949–1999\"           \"1958–2003\"           \"1930–2022\"           \"1926–1944\"          \n[116] \"1926–1944\"           \"2003–2022\"           \"1998–2022\"           \"1903–2022\"           \"1993–2022\"          \n[121] \"1990–2022\"           \"1958–2022\"           \"1998–2022\"           \"1903–2022\"           \"1958–2022\"          \n[126] \"1993–2022\"           \"1998–2022\"           \"1935–1958\"           \"1998–2022\"           \"1993–2022\"          \n[131] \"1993–2022\"           \"1949–2022\"           \"1926–1944\"           \"1949–2022\"           \"1958–2022\"          \n[136] \"1998–2022\"           \"1903–2022\"           \"1903–2022\"           \"1935–1944,1958–2022\" \"1998–2022\"          \n[141] \"1998–2022\"           \"1993–2022\"           \"1958–2022\"           \"1903–1910\"           \"1958–2022\"          \n[146] \"1998–2022\"           \"1903–2022\"           \"1903–1944\"           \"1958–2022\"           \"1998–2022\"          \n[151] \"1903–1990\"           \"1998–2022\"           \"1903–1910\"           \"1903–1944\"           \"1953–2022\"          \n[156] \"1903–2022\"           \"1903–1915,1958–2022\" \"1998–2022\"           \"1903–2022\"           \"1903–1910\"          \n[161] \"1926–2022\"           \"1958–1990\"           \"1993–2022\"           \"1903–2022\"           \"2021-2022\"          \n[166] \"2021-2022\"           \"2021-2022\"           \"2021-2022\"          \n```\n:::\n:::\n\n\n\n\nThat's better because the data format is now consistent, but it's not tidy. In the long run, what I really want is a nice tidy tibble: each row should correspond to a single observation. If \"Red\" was a colour in 1935, then there should be a row in my table for which `name = \"Red\"` and `year = 1935`. That's not quite what I have here, so I have more data wrangling to do.\n\nThe first thing I'm going to do is use `tidyr::separate()` to split the `years` variable into two variables, `years_1` and `years_2`. The `years_1` variable will contain the first time interval for which a particular crayon colour was in production, and the `years_2` variable will contain the second interval in which it was in production. For almost all colours, `years_2` will be `NA`. It's only those special cases like `\"1903–1910,1930–1990\"` that will have values in both. \n\nThen, because I don't really see a need to have two variables that both represent a period of time, I'll use `tidyr::pivot_longer()` to give myself a data set in which there is one row for every continuous time interval:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncrayola <- crayola |>\n  tidyr::separate(\n    col = years,\n    into = c(\"years_1\", \"years_2\"),\n    sep = \",\",\n    fill = \"right\"\n  ) |>\n  tidyr::pivot_longer(\n    cols = starts_with(\"years_\"),\n    names_prefix = \"years_\",\n    names_to = \"interval\",\n    values_to = \"years\"\n  ) |>\n  dplyr::filter(!is.na(years))\n```\n:::\n\n\nTo give you a sense of what the data looks like in this form, I'll pull out the rows corresponding to two different crayon colours, \"Maroon\" and \"Violet-Blue\":\n\n\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\ncrayola |>\n  dplyr::filter(name == \"Maroon\" | name == \"Violet-Blue\")\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 3 × 10\n  color   name        listed  notes                                     x16_box x24_box x32_box x64_box interval years    \n  <chr>   <chr>       <chr>   <chr>                                     <chr>   <chr>   <chr>   <chr>   <chr>    <chr>    \n1 #C32148 Maroon      #C32148 \"Known as \\\"Dark Red\\\", 1949–1958.[2]\"    \"No\"    \"No\"    \"No\"    \"No\"    1        1949–2022\n2 #766EC8 Violet-Blue #766EC8 \"Known as \\\"Blue-Violet\\\", 1930–1958.[2]\" \"\"      \"\"      \"\"      \"\"      1        1903–1910\n3 #766EC8 Violet-Blue #766EC8 \"Known as \\\"Blue-Violet\\\", 1930–1958.[2]\" \"\"      \"\"      \"\"      \"\"      2        1930–1990\n```\n:::\n:::\n\n\n\n\nThe \"Maroon\" crayon has been in production continuously since 1949, so there is only one row in the table for that one. The \"Violet-Blue\" crayon was in production \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncrayola <- crayola |>\n  tidyr::separate(\n    col = years,\n    into = c(\"year_started\", \"year_ended\")\n  ) |>\n  dplyr::mutate(\n    interval = as.integer(interval),\n    year_started = as.integer(year_started),\n    year_ended = as.integer(year_ended)\n  )\n```\n:::\n\n\n\n\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\ncrayola\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 174 × 11\n   color   name                    listed    notes                               x16_box x24_box x32_box x64_box inter…¹ year_…² year_…³\n   <chr>   <chr>                   <chr>     <chr>                               <chr>   <chr>   <chr>   <chr>     <int>   <int>   <int>\n 1 #ED0A3F Red                     \"#ED0A3F\" \"\"                                  \"Yes\"   \"Yes\"   \"Yes\"   \"Yes\"         1    1903    2022\n 2 #C32148 Maroon                  \"#C32148\" \"Known as \\\"Dark Red\\\", 1949–1958.… \"No\"    \"No\"    \"No\"    \"No\"          1    1949    2022\n 3 #FD0E35 Scarlet                 \"#FD0E35\" \"Known as \\\"Torch Red\\\", 1998.[2]\"  \"No\"    \"Yes\"   \"Yes\"   \"Yes\"         1    1998    2022\n 4 #C62D42 Brick Red               \"#C62D42\" \"\"                                  \"No\"    \"No\"    \"No\"    \"Yes\"         1    1958    2022\n 5 #CC474B English Vermilion       \"\"        \"Also spelled \\\"Vermillion\\\".[2]\"   \"\"      \"\"      \"\"      \"\"            1    1903    1935\n 6 #CC3336 Madder Lake             \"\"        \"\"                                  \"\"      \"\"      \"\"      \"\"            1    1903    1935\n 7 #E12C2C Permanent Geranium Lake \"\"        \"\"                                  \"\"      \"\"      \"\"      \"\"            1    1903    1910\n 8 #D92121 Maximum Red             \"\"        \"Part of the Munsell line.[2]\"      \"\"      \"\"      \"\"      \"\"            1    1926    1944\n 9 #B94E48 Chestnut                \"#B94E48\" \"Known as \\\"Indian Red\\\" before 19… \"No\"    \"No\"    \"Yes\"   \"Yes\"         1    1903    2022\n10 #FF5349 Orange-Red              \"#FF5349\" \"\"                                  \"\"      \"\"      \"\"      \"\"            1    1958    1990\n# … with 164 more rows, and abbreviated variable names ¹​interval, ²​year_started, ³​year_ended\n```\n:::\n:::\n\n\n\n\nWe're getting close. At this point the last bit of work I have to do to fix the year data is unpack it. Instead of representing the data for Maroon crayons with one row with a `year_started` value of 1949 and `year_ended` value of 2022, I want to have a single column called `year`, and the data should contain one row for every year in which Maroon was in production. Somewhere in the back of my head there is the thought that there must be an easy way to do this with tidyr, but my ingenuity failed me this time and I fell back on my usual solution... `purrr::pmap_dfr()`.\n\nIt's a two-step process. Step one: write a little function that expects to receive the values stored in one row of the existing data frame, and returns a new data frame in the format I want. In this case, I want a tibble that has one row for each `year` in range starting `year_started` and ending `year_ended`, but otherwise has the same structure as the existing data. The `unpack_row()` function below does that:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunpack_row <- function(color, name, year_started, year_ended, ...) {\n  tibble::tibble(\n    name = name,\n    color = color,\n    year = year_started:year_ended,\n    ...\n  )\n}\n```\n:::\n\n\nSo now I'll do the unpacking with `purrr::pmap_dfr()`, sort the rows into a nice order using `dplyr::arrange()`, and add an `id` column to ensure that every row in the table has a unique identifier:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncrayola <- crayola |>\n  purrr::pmap_dfr(unpack_row) |>\n  dplyr::arrange(year, color) |>\n  dplyr::mutate(id = dplyr::row_number())\n```\n:::\n\n\nVoilà!\n\n\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\ncrayola\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 7,749 × 11\n   name                color    year listed    notes                                       x16_box x24_box x32_box x64_box inter…¹    id\n   <chr>               <chr>   <int> <chr>     <chr>                                       <chr>   <chr>   <chr>   <chr>     <int> <int>\n 1 Black               #000000  1903 \"#000000\" \"\"                                          \"Yes\"   \"Yes\"   \"Yes\"   \"Yes\"         1     1\n 2 Midnight Blue       #003366  1903 \"#003366\" \"Known as \\\"Prussian Blue\\\", 1903–1958.[2]\" \"No\"    \"No\"    \"No\"    \"No\"          1     2\n 3 Pine Green          #01796F  1903 \"#01796F\" \"Known as \\\"Dark Chrome Green\\\" (\\\"Chrome … \"No\"    \"No\"    \"No\"    \"No\"          1     3\n 4 Green               #01A638  1903 \"#01A638\" \"\"                                          \"Yes\"   \"Yes\"   \"Yes\"   \"Yes\"         1     4\n 5 Blue (I)            #2EB4E6  1903 \"\"        \"Known as \\\"Celestial Blue\\\", 1935–1949, a… \"\"      \"\"      \"\"      \"\"            1     5\n 6 Ultramarine Blue    #3F26BF  1903 \"\"        \"\"                                          \"\"      \"\"      \"\"      \"\"            1     6\n 7 Van Dyke Brown      #664228  1903 \"\"        \"Same color as \\\"Brown\\\" (1903–1910).[2]\"   \"\"      \"\"      \"\"      \"\"            1     7\n 8 Raw Umber           #665233  1903 \"#665233\" \"\"                                          \"\"      \"\"      \"\"      \"\"            1     8\n 9 Medium Chrome Green #6CA67C  1903 \"\"        \"\\\"Chrome Green, Medium\\\" on labels. Produ… \"\"      \"\"      \"\"      \"\"            1     9\n10 Celestial Blue      #7070CC  1903 \"\"        \"\"                                          \"\"      \"\"      \"\"      \"\"            1    10\n# … with 7,739 more rows, and abbreviated variable name ¹​interval\n```\n:::\n:::\n\n\n\n\n\n\n## Act III: I said pet, I said LUV, I said pet...\n\nOkay I have one last thing to do before I'm done with the data wrangling. Having hex strings associated with each crayon colour is nice and is exactly what I need for plotting, but you can't construct a nice ordering of colours since colour space is three dimensional, more or less. I'm trying my very best to forget everything I ever learned about the psychophysics of human colour perception, but even so I'm not silly enough to try to work with raw RGB values. Instead I'll use the [colorspace](http://colorspace.r-forge.r-project.org/) package to convert extract hue/saturation/value coordinates, as well as my slightly-preferred method, [CIELUV color coordinates](https://en.wikipedia.org/wiki/CIELUV):\n\n\n::: {.cell}\n\n```{.r .cell-code}\nHSV <- colorspace::coords(as(colorspace::hex2RGB(crayola$color), \"HSV\"))\nLUV <- colorspace::coords(as(colorspace::hex2RGB(crayola$color), \"LUV\"))\n```\n:::\n\n\nEach of these commands returns a matrix with three columns and the same number of rows as the `crayola` data frame. The first few rows of the `HSV` matrix look like this:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nHSV[1:10,]\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n              H         S         V\n [1,]   0.00000 0.0000000 0.0000000\n [2,] 210.00000 1.0000000 0.4000000\n [3,] 175.00000 0.9917355 0.4745098\n [4,] 140.00000 0.9939759 0.6509804\n [5,] 196.30435 0.8000000 0.9019608\n [6,] 249.80392 0.8010471 0.7490196\n [7,]  25.16129 0.6078431 0.4000000\n [8,]  36.47059 0.5000000 0.4000000\n [9,] 136.55172 0.3493976 0.6509804\n[10,] 240.00000 0.4509804 0.8000000\n```\n:::\n:::\n\n\nSo now I can store all six coordinates in the `crayola` dataframe, along with the LUV-space version of \"hue\" which I compute in the last line here:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncrayola <- crayola |>\n  dplyr::mutate(\n    hue = HSV[, \"H\"],\n    sat = HSV[, \"S\"],\n    val = HSV[, \"V\"],\n    L = LUV[, \"L\"],\n    U = LUV[, \"U\"],\n    V = LUV[, \"V\"],\n    hue2 = atan2(V, U)\n  )\n```\n:::\n\n\nThe Wikipedia page on CIELUV has a little more information on this, but really the thing that matters is that the `hue2` column is the variable I'm going to use to arrange the crayon colours when plotting them later. And so the moment arrives that, at long last, I have the data...\n\n\n\n\n::: {.cell .column-page}\n\n```{.r .cell-code}\ncrayola\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 7,749 × 18\n   name             color  year listed notes x16_box x24_box x32_box x64_box inter…¹    id   hue   sat   val     L      U       V   hue2\n   <chr>            <chr> <int> <chr>  <chr> <chr>   <chr>   <chr>   <chr>     <int> <int> <dbl> <dbl> <dbl> <dbl>  <dbl>   <dbl>  <dbl>\n 1 Black            #000…  1903 \"#000… \"\"    \"Yes\"   \"Yes\"   \"Yes\"   \"Yes\"         1     1   0   0     0       0     0      0     -3.14 \n 2 Midnight Blue    #003…  1903 \"#003… \"Kno… \"No\"    \"No\"    \"No\"    \"No\"          1     2 210   1     0.4    21.3 -11.9  -40.1   -1.86 \n 3 Pine Green       #017…  1903 \"#017… \"Kno… \"No\"    \"No\"    \"No\"    \"No\"          1     3 175   0.992 0.475  45.4 -36.1    0.638  3.12 \n 4 Green            #01A…  1903 \"#01A… \"\"    \"Yes\"   \"Yes\"   \"Yes\"   \"Yes\"         1     4 140   0.994 0.651  59.5 -54.9   61.6    2.30 \n 5 Blue (I)         #2EB…  1903 \"\"     \"Kno… \"\"      \"\"      \"\"      \"\"            1     5 196.  0.8   0.902  68.7 -44.6  -53.4   -2.27 \n 6 Ultramarine Blue #3F2…  1903 \"\"     \"\"    \"\"      \"\"      \"\"      \"\"            1     6 250.  0.801 0.749  29.9  -2.77 -96.9   -1.60 \n 7 Van Dyke Brown   #664…  1903 \"\"     \"Sam… \"\"      \"\"      \"\"      \"\"            1     7  25.2 0.608 0.4    31.5  25.9   19.9    0.655\n 8 Raw Umber        #665…  1903 \"#665… \"\"    \"\"      \"\"      \"\"      \"\"            1     8  36.5 0.5   0.4    36.2  14.7   22.3    0.987\n 9 Medium Chrome G… #6CA…  1903 \"\"     \"\\\"C… \"\"      \"\"      \"\"      \"\"            1     9 137.  0.349 0.651  63.3 -28.3   26.3    2.39 \n10 Celestial Blue   #707…  1903 \"\"     \"\"    \"\"      \"\"      \"\"      \"\"            1    10 240   0.451 0.8    51.1  -5.49 -76.1   -1.64 \n# … with 7,739 more rows, and abbreviated variable name ¹​interval\n```\n:::\n:::\n\n\n\n\n\n## The intermission is late, so what?\n\nAs a rule I make it a habit to assume that, while the internet never forgets anything at all in the general sense, it doesn't remember anything *specific* for any interval longer than I'd trust a man not to have conveniently lost my phone number. Moreover, while I also make it a habit not to care greatly about the archival properties of What Went Down In The Stalls At The Duke On Friday, I'm slightly more invested in, um ... crayons, I guess. Or data science practices in R. Whatever. \n\nMy point here is that the table on wikipedia isn't an archival source so there's no guarantee that anything I've done up to this point is reproducible unless I do a bit of extra work myself and save a copy of the data...\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfolder <- here::here(\"posts\", \"2022-12-18_crayola-crayon-colours\")\nreadr::write_csv(crayola, fs::path(folder, \"crayola.csv\"))\n```\n:::\n\n\n\n## Act IV: Not even Chekhov expects it to go off\n\nThe final act of our little drama has arrived. Time to make a plot. The impression I get from reading the original blog posts by Stephen Von Worley is that the intention was never to look at the *number* of crayon colours in the Crayola standard set over time, but rather to explore the composition of those colours. Has the pattern of colours remained stable over time or has it shifted in hue? But I have the data now so I miight as well take a look. Here's a stacked bar chart showing the number of distinct crayon colours in the Crayola standard set every year from 1903 to 2022. It has grown over time but the growth looks linear, not exponential:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(ggplot2)\nbase <- crayola |> \n  dplyr::mutate(\n    color = forcats::fct_reorder(color, hue2)\n  ) |> \n  ggplot(aes(\n    x = year,\n    group = color,\n    fill = color\n  )) +\n  scale_fill_identity() +\n  NULL\n\nbase + geom_bar(show.legend = FALSE) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/first-plot-1.png){width=672}\n:::\n:::\n\n\nBut let's be honest, shall we? No-one at all (least of all me) is interested in determining whether the rate of growth of Crayola crayon colours in the standard set is exponential or linear. It's just fun. The real reason we all love the Crayola post was that the image was so terribly pretty, so let's start making something pretty, yes? \n\nWe can start getting something a little closer to the original if we set `position = \"fill\"`, and I'm going to use `theme_void()` because honestly it's just prettier without the words and numbers getting in the way...\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nbase + \n  theme_void() +\n  geom_bar(\n    position = \"fill\",\n    linetype = \"blank\",\n    width = 1,\n    show.legend = FALSE\n  ) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-17-1.png){fig-align='center' width=768}\n:::\n:::\n\n\nIt's pretty, but it's noticeably different from the original one. In my version, there are 39 separate colours depicted on the left hand side, whereas the version that was going around on mastodon (and appears in the original blog posts) has only 8. Out of paranoia, I decided to check the counts in my data...\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncrayola |> \n  dplyr::count(year) |>\n  dplyr::filter(year %in% seq(1903, 2003, by = 10))\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 11 × 2\n    year     n\n   <int> <int>\n 1  1903    40\n 2  1913    32\n 3  1923    31\n 4  1933    57\n 5  1943    57\n 6  1953    49\n 7  1963    64\n 8  1973    64\n 9  1983    64\n10  1993    80\n11  2003   108\n```\n:::\n:::\n\n\n...which does seem consistent with what the [history of Crayola crayons](https://en.wikipedia.org/wiki/History_of_Crayola_crayons) wikipedia article has to say on the topic too: \n\n> Early Crayola advertising mentions thirty different colors, although there is no official list; in fact thirty-eight different crayons are known from Crayola boxes of this period. The largest labeled assortment was box No. 51, titled Crayola Young Artists' Drawing Crayons, which included twenty-eight different crayons. Other colors were found in different boxes, including the \"Rubens\" No. 500, a twenty-four crayon assortment.\n\nOkay, so if I haven't made a mistake, what is going on? It turns out that although Steven Von Worley's blog post still manages to point to the \"same\" Wikipedia page 12 years later, the contents of the page have changed considerably. The original post was published January 15th 2010. Conveniently the wayback machine has a [snapshot of that page](http://web.archive.org/web/20100209002742/https://en.wikipedia.org/wiki/List_of_Crayola_crayon_colors) from only a few weeks later, on February 9th. I have a very different version of the Crayola colours data than Steven's friend Velociraptor had. \n\nThere are 133 colours listed in the 2010 version, and it's missing all the colours that had gone out of production earlier than 1990. \"English Vermillion\", for example, was in production from 1903 to 1935. It appears in the 2022 version of the Wikipedia data (and so it's represented in my plots above), but it was omitted in the 2010 version of the Wikipedia data and so doesn't appear in the version of the image that went around on Mastodon yesterday. \n\nHm. So what happens to my data if I crudely simulate a censoring process a little bit like the one that applied to the 2010 version of the Wikipedia page? Let's simply ignore all crayon colours that were out of production earlier than 1990, shall we?\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nbase + \n  theme_void() +\n  geom_bar(\n    data =  crayola |> \n      dplyr::group_by(name) |>\n      dplyr::filter(max(year) > 1990) |>\n      dplyr::ungroup() |>\n      dplyr::mutate(color = forcats::fct_reorder(color, hue2)),\n    position = \"fill\",\n    linetype = \"blank\",\n    width = 1,\n    show.legend = FALSE\n  ) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/second-plot-1.png){fig-align='center' width=768}\n:::\n:::\n\n\nStill not exactly equivalent, but it's closer.\n\nMore to the point however, I think we all have to admit that this is really the kind of data set that desperately needs to be plotted with the aid of `coord_polar()`, no?\n\n\n::: {.cell .column-screen-inset layout-align=\"center\"}\n\n```{.r .cell-code}\nbase + \n  theme_void() +\n  coord_polar(theta = \"y\") + \n  geom_bar(\n    position = \"fill\",\n    linetype = \"blank\",\n    width = 1,\n    show.legend = FALSE\n  ) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/third-plot-1.png){fig-align='center' width=1152}\n:::\n:::\n\n\nI mean... not that anyone really cares what this represents, but each concentric ring represents a year of data: 1903 is in the middle, and 2022 is on the outside. Within each annual ring there is an equal-angle segment for every crayon colour in the data for that year. Whenever the crayons changed, the rings shift a bit. The colours are arranged around the circle by hue. Well, the hue-like quantity computed from the chromaticity components of the LUV coordinates. Whatever. \n\nAlternatively, we could turn this into a racetrack plot, where each individual colour fills an angular section of constant size, and so only the year with the most crayon colours (2022) wraps the full way round the circle. That gives us this:\n\n\n::: {.cell .column-screen-inset layout-align=\"center\"}\n\n```{.r .cell-code}\nbase + \n  theme_void() +\n  coord_polar(theta = \"y\") + \n  geom_bar(\n    linetype = \"blank\",\n    width = 1,\n    show.legend = FALSE\n  ) \n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/fourth-plot-1.png){fig-align='center' width=1152}\n:::\n:::\n\n\nI'm not sure it has a lot of value as a data visualisation but it is so terribly pretty!\n\n<!--------------- appendices go here ----------------->\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}