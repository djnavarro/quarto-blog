{
  "hash": "153cca4fc44e56ac2981942461b908c4",
  "result": {
    "markdown": "---\ntitle: \"Fun and games with p5.js and observable.js in quarto\"\nauthor:\n  - name: Danielle Navarro\n    url: https://djnavarro.net\n    affiliation: I'm on smoko\n    affiliation-url: https://www.youtube.com/watch?v=j58V2vC9EPc\n    orcid: 0000-0001-7648-6578\ndescription: \"Because I can\"\ndate: \"2023-01-14\"\ncategories: [Art, P5, Observable, Javascript, Quarto]\nimage: donut.jpg\n---\n\n\n<!--------------- my typical setup ----------------->\n\n\n\n\n\n<!--------------- post begins here ----------------->\n\n> Be sweet to me, baby <br>\nI wanna believe in you <br>\nI wanna believe <br>\nBe sweet <br>\nBe sweet to me, baby <br>\nI wanna believe in you <br>\nI wanna believe in something <br>\n&nbsp; -- Japanese Breakfast\n\nOkay, so... I write this blog using [quarto](https://quarto.org/), and quarto has native support for [observable.js](https://observablehq.com)\n... and observable.js supports third-party javascript libraries such as [p5.js](https://p5js.org/) executing in code cells... so, like... I can use p5.js to create generative art, inside the browser, inside a blog post? Right?\n\nApparently the answer to that is yes. \n\nThere is but one tiny problem. I don't know anything about observable.js or p5.js. I supposed I'd best remedy that.\n\n## Enabling p5js\n\nThe first step in the process is enabling p5.js, which is not one of the core libraries in observable, and is not immediately available. To use a third-party library that exists as an [NPM modules](https://docs.npmjs.com/about-packages-and-modules) we can import it using `require()`.\n\n\n```{ojs}\n//| output: all\nP5 = require(\"p5\")\n```\n\n\nJust like that, thanks to the joy of the [jsDelivr CDN](https://www.jsdelivr.com/), p5.js is now available to me in this post.\n\nWell, sort of. As you can see from the output,^[An assignment like this would not normally produce any visible output for an observable.js code cell within in a quarto document, but I've set `output: all` for expository purposes.] the `P5` object is a function that takes three inputs. To do anything useful with it, I'll use a trick I learned from [this fabulous notebook by Tom MacWright](https://observablehq.com/@tmcw/p5) to run p5.js in \"instance mode\". Normally, p5.js works by defining a lot of global objects. That works fine if you're only doing one \"sketch\" on a single page, but it's not so clean if you want to write modular code where a single page (like this one) could contain multiple p5.js sketches.  \n\nTo run p5.js in instance mode, and in a way that plays nicely with observable.js and quarto, I'll define  `createSketch` as a [generator function](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/function*):\n\n\n```{ojs}\nfunction* createSketch(sketch) {\n  const element = DOM.element('div');\n  yield element;\n  const instance = new P5(sketch, element, true);\n  try {\n    while (true) {\n      yield element;\n    }\n  } finally {\n    instance.remove();\n  }\n}\n```\n\n\nUsing this approach, each instantiation of `P5` is attached to a div element that created when `createSketch` is called. If you want to know more about how this approach works, it's probably best to go to the original source that I adapted it from, because Tom has commented it and explained it nicely: [observablehq.com/@tmcw/p5](https://observablehq.com/@tmcw/p5)\n\n## Example 1\n\n\n```{ojs}\ncreateSketch(s => {\n  \n    s.setup = function() {\n      s.createCanvas(500, 500);\n      s.background(\"black\");\n      s.fill(\"red\");    \n      s.circle(250, 250, 100);\n      s.fill(\"black\");\n      s.circle(250, 250, 30);\n    };\n    \n  }\n)\n```\n\n\n\n## Example 2\n\n\n```{ojs}\ncreateSketch(s => {\n  \n    s.setup = function() {\n      s.createCanvas(500, 500);\n      s.background(0);\n      s.noStroke();\n    };\n    \n    s.draw = function() {\n      s.translate(\n        100 * s.cos(s.millis() * .001 * s.PI),\n        100 * s.sin(s.millis() * .001 * s.PI),\n      );\n      if (s.random(0, 1) < .1) {\n        s.fill(s.random(0, 255));\n      }\n      s.circle(250, 250, 100);\n    };\n    \n  }\n)\n```\n\n\n\n## Example 3\n\nAdaptation of this example: [observablehq.com/@tmcw/p5](https://observablehq.com/@tmcw/p5)\n\n\n::: {.cell}\n\n```{.css .cell-code}\n@import url(https://fonts.googleapis.com/css?family=Courgette);\n```\n\n\n<style type=\"text/css\">\n@import url(https://fonts.googleapis.com/css?family=Courgette);\n</style>\n:::\n\n```{ojs}\ncreateSketch(s => {\n  \n    s.setup = function() {\n      s.createCanvas(746, 300);\n      s.textFont('Courgette');\n      s.textStyle(s.BOLD);\n      s.textAlign(s.CENTER, s.CENTER)\n    };\n    \n    s.draw = function() {\n      s.translate(\n        s.millis() * (-0.1) % (s.width + 1000), \n        s.height / 2\n      );\n      s.background('#222222');\n      s.fill('#DC3F74').textSize(100);\n      s.text('Donuts: A Hole World', s.width + 500, 0);\n    };\n    \n  }\n)\n```\n\n\n\n\n\n## Example 4\n\n\n\n```{ojs}\ncreateSketch(s => {\n\n  s.setup = function() {\n    s.createCanvas(746, 746, s.WEBGL);\n    s.noStroke();\n  }\n\n  s.draw = function() {\n\n    s.background(0);\n\n    let locX = s.mouseX - s.height / 2;\n    let locY = s.mouseY - s.width / 2;  \n    \n    s.ambientLight(60, 60, 60);\n    s.pointLight(190, 80, 190, locX, locY, 100);\n    s.pointLight(80, 80, 190, 0, 0, 100);\n  \n    s.specularMaterial(255);\n    s.rotateX(s.frameCount * 0.01);\n    s.rotateY(s.frameCount * 0.01);\n    s.torus(150, 80, 64, 64);\n  }\n\n})\n```\n\n\n\n## Example 5\n\nFinal example is adapted from the generative art course by Bernat Ferragut: [ga-course.surge.sh](https://ga-course.surge.sh/)\n\n\n\n```{ojs}\ncreateSketch(s => {\n\n  let n = 100;\n  let dot;\n  let dotList = [];\n  let palette = [\n    s.color(\"#6B1B00\"),\n    s.color(\"#AE8B70\"),\n    s.color(\"#F9FEFB\"),\n    s.color(\"#56382D\") \n  ];\n\n  s.setup = function() {\n    s.createCanvas(746, 746);\n    for(let i = 0; i < n; i++) {\n      let angle = s.random(0, s.TWO_PI);\n      let radius = s.width * s.random(.12, .33);\n      dotList.push(dot = new Dot(\n        s,\n        s.width/2 + s.cos(angle) * radius,\n        s.height/2 + s.sin(angle) * radius,\n        s.random(palette),\n        s.random(1, 5)\n      ));\n    }\n  };\n    \n  s.draw = function() {\n    dotList.map(dot => {\n      dot.on();\n      dot.move();\n      dot.bounce(s.width * .35, true);\n      dot.bounce(s.width * .1, false);\n    });\n  };\n})\n\n```\n\n\nwhere\n\n\n```{ojs}\nclass Dot {\n  constructor(sketch, x, y, colour, size) {\n    this.s = sketch;\n    this.x = x | 0;\n    this.y = y | 0;\n    this.colour = colour;\n    this.size = size;\n    this.velX = this.s.random(-2, 2);\n    this.velY = this.s.random(-2, 2);\n  }\n\n  on() {\n    this.s.noStroke();\n    this.s.fill(this.colour);\n    this.s.circle(this.x, this.y, this.size);\n  }\n\n  move() {\n    this.x += this.velX;\n    this.y += this.velY;\n  }\n  \n  bounce(radius, inside) {\n    let x = this.x - this.s.width/2;\n    let y = this.y - this.s.height/2;\n    if (\n      inside && x*x + y*y > radius * radius ||\n      !inside && x*x + y*y < radius * radius\n    ) {\n    \n      // https://math.stackexchange.com/a/611836\n      let nx = x / this.s.sqrt(x*x + y*y);\n      let ny = y / this.s.sqrt(x*x + y*y);\n      let vx = this.velX;\n      let vy = this.velY;\n      this.velX = (ny*ny - nx*nx)*vx - 2*nx*ny*vy;\n      this.velY = (nx*nx - ny*ny)*vy - 2*nx*ny*vx;\n    \n    }\n  }\n  \n}\n```\n\n\n<!--------------- appendices go here ----------------->\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}